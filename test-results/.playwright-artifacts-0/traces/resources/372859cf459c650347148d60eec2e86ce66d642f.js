define("dojo/dnd/Container",["dojo","dojo/dnd/common","dojo/parser"],function(a){a.declare("dojo.dnd.Container",null,{skipForm:false,constructor:function(b,c){this.node=a.byId(b);if(!c){c={};}this.creator=c.creator||null;this.skipForm=c.skipForm;this.parent=c.dropParent&&a.byId(c.dropParent);this.map={};this.current=null;this.containerState="";a.addClass(this.node,"dojoDndContainer");if(!(c&&c._skipStartup)){this.startup();}this.events=[a.connect(this.node,"onmouseover",this,"onMouseOver"),a.connect(this.node,"onmouseout",this,"onMouseOut"),a.connect(this.node,"ondragstart",this,"onSelectStart"),a.connect(this.node,"onselectstart",this,"onSelectStart")];},creator:function(){},getItem:function(b){return this.map[b];},setItem:function(b,c){this.map[b]=c;},delItem:function(b){delete this.map[b];},forInItems:function(d,h){h=h||a.global;var b=this.map,g=a.dnd._empty;for(var c in b){if(c in g){continue;}d.call(h,b[c],c,this);}return h;},clearItems:function(){this.map={};},getAllNodes:function(){return a.query("> .dojoDndItem",this.parent);},sync:function(){var b={};this.getAllNodes().forEach(function(e){if(e.id){var d=this.getItem(e.id);if(d){b[e.id]=d;return;}}else{e.id=a.dnd.getUniqueId();}var c=e.getAttribute("dndType"),f=e.getAttribute("dndData");b[e.id]={data:f||e.innerHTML,type:c?c.split(/\s*,\s*/):["text"]};},this);this.map=b;return this;},insertNodes:function(f,e,b){if(!this.parent.firstChild){b=null;}else{if(e){if(!b){b=this.parent.firstChild;}}else{if(b){b=b.nextSibling;}}}if(b){for(var d=0;d<f.length;++d){var c=this._normalizedCreator(f[d]);this.setItem(c.node.id,{data:c.data,type:c.type});this.parent.insertBefore(c.node,b);}}else{for(var d=0;d<f.length;++d){var c=this._normalizedCreator(f[d]);this.setItem(c.node.id,{data:c.data,type:c.type});this.parent.appendChild(c.node);}}return this;},destroy:function(){a.forEach(this.events,a.disconnect);this.clearItems();this.node=this.parent=this.current=null;},markupFactory:function(c,b){c._skipStartup=true;return new a.dnd.Container(b,c);},startup:function(){if(!this.parent){this.parent=this.node;if(this.parent.tagName.toLowerCase()=="table"){var b=this.parent.getElementsByTagName("tbody");if(b&&b.length){this.parent=b[0];}}}this.defaultCreator=a.dnd._defaultCreator(this.parent);this.sync();},onMouseOver:function(c){var d=c.relatedTarget;while(d){if(d==this.node){break;}try{d=d.parentNode;}catch(b){d=null;}}if(!d){this._changeState("Container","Over");this.onOverEvent();}d=this._getChildByEvent(c);if(this.current==d){return;}if(this.current){this._removeItemClass(this.current,"Over");}if(d){this._addItemClass(d,"Over");}this.current=d;},onMouseOut:function(c){for(var d=c.relatedTarget;d;){if(d==this.node){return;}try{d=d.parentNode;}catch(b){d=null;}}if(this.current){this._removeItemClass(this.current,"Over");this.current=null;}this._changeState("Container","");this.onOutEvent();},onSelectStart:function(b){if(!this.skipForm||!a.dnd.isFormElement(b)){a.stopEvent(b);}},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(b,e){var d="dojoDnd"+b;var c=b.toLowerCase()+"State";a.replaceClass(this.node,d+e,d+this[c]);this[c]=e;},_addItemClass:function(c,b){a.addClass(c,"dojoDndItem"+b);},_removeItemClass:function(c,b){a.removeClass(c,"dojoDndItem"+b);},_getChildByEvent:function(d){var c=d.target;if(c){for(var b=c.parentNode;b;c=b,b=c.parentNode){if(b==this.parent&&a.hasClass(c,"dojoDndItem")){return c;}}}return null;},_normalizedCreator:function(c,d){var b=(this.creator||this.defaultCreator).call(this,c,d);if(!a.isArray(b.type)){b.type=["text"];}if(!b.node.id){b.node.id=a.dnd.getUniqueId();}a.addClass(b.node,"dojoDndItem");return b;}});a.dnd._createNode=function(b){if(!b){return a.dnd._createSpan;}return function(c){return a.create(b,{innerHTML:c});};};a.dnd._createTrTd=function(c){var b=a.create("tr");a.create("td",{innerHTML:c},b);return b;};a.dnd._createSpan=function(b){return a.create("span",{innerHTML:b});};a.dnd._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"};a.dnd._defaultCreator=function(d){var b=d.tagName.toLowerCase();var e=b=="tbody"||b=="thead"?a.dnd._createTrTd:a.dnd._createNode(a.dnd._defaultCreatorNodes[b]);return function(g,i){var c=g&&a.isObject(g),h,f,j;if(c&&g.tagName&&g.nodeType&&g.getAttribute){h=g.getAttribute("dndData")||g.innerHTML;f=g.getAttribute("dndType");f=f?f.split(/\s*,\s*/):["text"];j=g;}else{h=(c&&g.data)?g.data:g;f=(c&&g.type)?g.type:["text"];j=(i=="avatar"?a.dnd._createSpan:e)(String(h));}if(!j.id){j.id=a.dnd.getUniqueId();}return{node:j,data:h,type:f};};};return a.dnd.Container;});