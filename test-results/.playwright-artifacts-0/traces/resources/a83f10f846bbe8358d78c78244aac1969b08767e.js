define("dijit/Dialog",["dojo","dijit","text!dijit/templates/Dialog.html","dojo/dnd/move","dojo/dnd/TimedMoveable","dojo/fx","dojo/window","dijit/_Widget","dijit/_Templated","dijit/_CssStateMixin","dijit/form/_FormMixin","dijit/_DialogMixin","dijit/DialogUnderlay","dijit/layout/ContentPane","i18n!dijit/nls/common","dijit/TooltipDialog"],function(a,b){a.declare("dijit._DialogBase",[b._Templated,b.form._FormMixin,b._DialogMixin,b._CssStateMixin],{templateString:a.cache("dijit","templates/Dialog.html"),baseClass:"dijitDialog",cssStateNodes:{closeButtonNode:"dijitDialogCloseIcon"},attributeMap:a.delegate(b._Widget.prototype.attributeMap,{title:[{node:"titleNode",type:"innerHTML"},{node:"titleBar",type:"attribute"}],"aria-describedby":""}),open:false,duration:b.defaultDuration,refocus:true,autofocus:true,_firstFocusItem:null,_lastFocusItem:null,doLayout:false,draggable:true,"aria-describedby":"",postMixInProperties:function(){var c=a.i18n.getLocalization("dijit","common");a.mixin(this,c);this.inherited(arguments);},postCreate:function(){a.style(this.domNode,{display:"none",position:"absolute"});a.body().appendChild(this.domNode);this.inherited(arguments);this.connect(this,"onExecute","hide");this.connect(this,"onCancel","hide");this._modalconnects=[];},onLoad:function(){this._position();if(this.autofocus&&b._DialogLevelManager.isTop(this)){this._getFocusItems(this.domNode);b.focus(this._firstFocusItem);}this.inherited(arguments);},_endDrag:function(c){if(c&&c.node&&c.node===this.domNode){this._relativePosition=a.position(c.node);}},_setup:function(){var c=this.domNode;if(this.titleBar&&this.draggable){this._moveable=(a.isIE==6)?new a.dnd.TimedMoveable(c,{handle:this.titleBar}):new a.dnd.Moveable(c,{handle:this.titleBar,timeout:0});this._dndListener=a.subscribe("/dnd/move/stop",this,"_endDrag");}else{a.addClass(c,"dijitDialogFixed");}this.underlayAttrs={dialogId:this.id,"class":a.map(this["class"].split(/\s/),function(d){return d+"_underlay";}).join(" ")};},_size:function(){this._checkIfSingleChild();if(this._singleChild){if(this._singleChildOriginalStyle){this._singleChild.domNode.style.cssText=this._singleChildOriginalStyle;}delete this._singleChildOriginalStyle;}else{a.style(this.containerNode,{width:"auto",height:"auto"});}var f=a._getMarginSize(this.domNode);var c=a.window.getBox();if(f.w>=c.w||f.h>=c.h){var d=Math.min(f.w,Math.floor(c.w*0.75)),e=Math.min(f.h,Math.floor(c.h*0.75));if(this._singleChild&&this._singleChild.resize){this._singleChildOriginalStyle=this._singleChild.domNode.style.cssText;this._singleChild.resize({w:d,h:e});}else{a.style(this.containerNode,{width:d+"px",height:e+"px",overflow:"auto",position:"relative"});}}else{if(this._singleChild&&this._singleChild.resize){this._singleChild.resize();}}},_position:function(){if(!a.hasClass(a.body(),"dojoMove")){var f=this.domNode,c=a.window.getBox(),g=this._relativePosition,h=g?null:a._getBorderBox(f),d=Math.floor(c.l+(g?g.x:(c.w-h.w)/2)),e=Math.floor(c.t+(g?g.y:(c.h-h.h)/2));a.style(f,{left:d+"px",top:e+"px"});}},_onKey:function(c){if(c.charOrCode){var d=a.keys;var f=c.target;if(c.charOrCode===d.TAB){this._getFocusItems(this.domNode);}var h=(this._firstFocusItem==this._lastFocusItem);if(f==this._firstFocusItem&&c.shiftKey&&c.charOrCode===d.TAB){if(!h){b.focus(this._lastFocusItem);}a.stopEvent(c);}else{if(f==this._lastFocusItem&&c.charOrCode===d.TAB&&!c.shiftKey){if(!h){b.focus(this._firstFocusItem);}a.stopEvent(c);}else{while(f){if(f==this.domNode||a.hasClass(f,"dijitPopup")){if(c.charOrCode==d.ESCAPE){this.onCancel();}else{return;}}f=f.parentNode;}if(c.charOrCode!==d.TAB){a.stopEvent(c);}else{if(!a.isOpera){try{this._firstFocusItem.focus();}catch(g){}}}}}}},show:function(){if(this.open){return;}if(!this._started){this.startup();}if(!this._alreadyInitialized){this._setup();this._alreadyInitialized=true;}if(this._fadeOutDeferred){this._fadeOutDeferred.cancel();}this._modalconnects.push(a.connect(window,"onscroll",this,"layout"));this._modalconnects.push(a.connect(window,"onresize",this,function(){var d=a.window.getBox();if(!this._oldViewport||d.h!=this._oldViewport.h||d.w!=this._oldViewport.w){this.layout();this._oldViewport=d;}}));this._modalconnects.push(a.connect(this.domNode,"onkeypress",this,"_onKey"));a.style(this.domNode,{opacity:0,display:""});this._set("open",true);this._onShow();this._size();this._position();var c;this._fadeInDeferred=new a.Deferred(a.hitch(this,function(){c.stop();delete this._fadeInDeferred;}));c=a.fadeIn({node:this.domNode,duration:this.duration,beforeBegin:a.hitch(this,function(){b._DialogLevelManager.show(this,this.underlayAttrs);}),onEnd:a.hitch(this,function(){if(this.autofocus&&b._DialogLevelManager.isTop(this)){this._getFocusItems(this.domNode);b.focus(this._firstFocusItem);}this._fadeInDeferred.callback(true);delete this._fadeInDeferred;})}).play();return this._fadeInDeferred;},hide:function(){if(!this._alreadyInitialized){return;}if(this._fadeInDeferred){this._fadeInDeferred.cancel();}var c;this._fadeOutDeferred=new a.Deferred(a.hitch(this,function(){c.stop();delete this._fadeOutDeferred;}));c=a.fadeOut({node:this.domNode,duration:this.duration,onEnd:a.hitch(this,function(){this.domNode.style.display="none";b._DialogLevelManager.hide(this);this.onHide();this._fadeOutDeferred.callback(true);delete this._fadeOutDeferred;})}).play();if(this._scrollConnected){this._scrollConnected=false;}a.forEach(this._modalconnects,a.disconnect);this._modalconnects=[];if(this._relativePosition){delete this._relativePosition;}this._set("open",false);return this._fadeOutDeferred;},layout:function(){if(this.domNode.style.display!="none"){if(b._underlay){b._underlay.layout();}this._position();}},destroy:function(){if(this._fadeInDeferred){this._fadeInDeferred.cancel();}if(this._fadeOutDeferred){this._fadeOutDeferred.cancel();}if(this._moveable){this._moveable.destroy();}if(this._dndListener){a.unsubscribe(this._dndListener);}a.forEach(this._modalconnects,a.disconnect);b._DialogLevelManager.hide(this);this.inherited(arguments);}});a.declare("dijit.Dialog",[b.layout.ContentPane,b._DialogBase],{});b._DialogLevelManager={show:function(c,f){var e=b._dialogStack;e[e.length-1].focus=b.getFocus(c);var d=b._underlay;if(!d||d._destroyed){d=b._underlay=new b.DialogUnderlay(f);}else{d.set(c.underlayAttrs);}var g=e[e.length-1].dialog?e[e.length-1].zIndex+2:950;if(e.length==1){d.show();}a.style(b._underlay.domNode,"zIndex",g-1);a.style(c.domNode,"zIndex",g);e.push({dialog:c,underlayAttrs:f,zIndex:g});},hide:function(g){var h=b._dialogStack;if(h[h.length-1].dialog==g){h.pop();var f=h[h.length-1];if(h.length==1){if(!b._underlay._destroyed){b._underlay.hide();}}else{a.style(b._underlay.domNode,"zIndex",f.zIndex-1);b._underlay.set(f.underlayAttrs);}if(g.refocus){var d=f.focus;if(!d||(f.dialog&&!a.isDescendant(d.node,f.dialog.domNode))){f.dialog._getFocusItems(f.dialog.domNode);d=f.dialog._firstFocusItem;}try{b.focus(d);}catch(i){}}}else{var c=a.indexOf(a.map(h,function(e){return e.dialog;}),g);if(c!=-1){h.splice(c,1);}}},isTop:function(c){var d=b._dialogStack;return d[d.length-1].dialog==c;}};b._dialogStack=[{dialog:null,focus:null,underlayAttrs:null}];return b.Dialog;});