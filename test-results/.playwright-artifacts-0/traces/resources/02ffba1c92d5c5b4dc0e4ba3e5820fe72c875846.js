define("dijit/tree/ForestStoreModel",["dojo","dijit","dijit/tree/TreeStoreModel"],function(a,b){a.declare("dijit.tree.ForestStoreModel",b.tree.TreeStoreModel,{rootId:"$root$",rootLabel:"ROOT",query:null,constructor:function(c){this.root={store:this,root:true,id:c.rootId,label:c.rootLabel,children:c.rootChildren};},mayHaveChildren:function(c){return c===this.root||this.inherited(arguments);},getChildren:function(c,e,d){if(c===this.root){if(this.root.children){e(this.root.children);}else{this.store.fetch({query:this.query,onComplete:a.hitch(this,function(f){this.root.children=f;e(f);}),onError:d});}}else{this.inherited(arguments);}},isItem:function(c){return(c===this.root)?true:this.inherited(arguments);},fetchItemByIdentity:function(c){if(c.identity==this.root.id){var d=c.scope?c.scope:a.global;if(c.onItem){c.onItem.call(d,this.root);}}else{this.inherited(arguments);}},getIdentity:function(c){return(c===this.root)?this.root.id:this.inherited(arguments);},getLabel:function(c){return(c===this.root)?this.root.label:this.inherited(arguments);},newItem:function(d,e,c){if(e===this.root){this.onNewRootItem(d);return this.store.newItem(d);}else{return this.inherited(arguments);}},onNewRootItem:function(c){},pasteItem:function(f,e,g,d,c){if(e===this.root){if(!d){this.onLeaveRoot(f);}}b.tree.TreeStoreModel.prototype.pasteItem.call(this,f,e===this.root?null:e,g===this.root?null:g,d,c);if(g===this.root){this.onAddToRoot(f);}},onAddToRoot:function(c){console.log(this,": item ",c," added to root");},onLeaveRoot:function(c){console.log(this,": item ",c," removed from root");},_requeryTop:function(){var c=this.root.children||[];this.store.fetch({query:this.query,onComplete:a.hitch(this,function(d){this.root.children=d;if(c.length!=d.length||a.some(c,function(f,e){return d[e]!=f;})){this.onChildrenChange(this.root,d);}})});},onNewItem:function(d,c){this._requeryTop();this.inherited(arguments);},onDeleteItem:function(c){if(a.indexOf(this.root.children,c)!=-1){this._requeryTop();}this.inherited(arguments);},onSetItem:function(e,d,c,f){this._requeryTop();this.inherited(arguments);}});return b.tree.ForestStoreModel;});