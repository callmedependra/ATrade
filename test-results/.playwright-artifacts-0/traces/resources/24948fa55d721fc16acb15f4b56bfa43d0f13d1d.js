define("dijit/_editor/RichText",["dojo","dijit","dijit/_Widget","dijit/_CssStateMixin","dijit/_editor/selection","dijit/_editor/range","dijit/_editor/html"],function(a,c){if(!a.config.useXDomain||a.config.allowXdRichTextSave){if(a._postLoad){(function(){var d=a.doc.createElement("textarea");d.id=c._scopeName+"._editor.RichText.value";a.style(d,{display:"none",position:"absolute",top:"-100px",height:"3px",width:"3px"});a.body().appendChild(d);})();}else{try{a.doc.write('<textarea id="'+c._scopeName+'._editor.RichText.value" style="display:none;position:absolute;top:-100px;left:-100px;height:3px;width:3px;overflow:hidden;"></textarea>');}catch(b){}}}a.declare("dijit._editor.RichText",[c._Widget,c._CssStateMixin],{constructor:function(d){this.contentPreFilters=[];this.contentPostFilters=[];this.contentDomPreFilters=[];this.contentDomPostFilters=[];this.editingAreaStyleSheets=[];this.events=[].concat(this.events);this._keyHandlers={};if(d&&a.isString(d.value)){this.value=d.value;}this.onLoadDeferred=new a.Deferred();},baseClass:"dijitEditor",inheritWidth:false,focusOnLoad:false,name:"",styleSheets:"",height:"300px",minHeight:"1em",isClosed:true,isLoaded:false,_SEPARATOR:"@@**%%__RICHTEXTBOUNDRY__%%**@@",_NAME_CONTENT_SEP:"@@**%%:%%**@@",onLoadDeferred:null,isTabIndent:false,disableSpellCheck:false,postCreate:function(){if("textarea"==this.domNode.tagName.toLowerCase()){console.warn("RichText should not be used with the TEXTAREA tag.  See dijit._editor.RichText docs.");}this.contentPreFilters=[a.hitch(this,"_preFixUrlAttributes")].concat(this.contentPreFilters);if(a.isMoz){this.contentPreFilters=[this._normalizeFontStyle].concat(this.contentPreFilters);this.contentPostFilters=[this._removeMozBogus].concat(this.contentPostFilters);}if(a.isWebKit){this.contentPreFilters=[this._removeWebkitBogus].concat(this.contentPreFilters);this.contentPostFilters=[this._removeWebkitBogus].concat(this.contentPostFilters);}if(a.isIE){this.contentPostFilters=[this._normalizeFontStyle].concat(this.contentPostFilters);}this.inherited(arguments);a.publish(c._scopeName+"._editor.RichText::init",[this]);this.open();this.setupDefaultShortcuts();},setupDefaultShortcuts:function(){var d=a.hitch(this,function(h,g){return function(){return !this.execCommand(h,g);};});var f={b:d("bold"),i:d("italic"),u:d("underline"),a:d("selectall"),s:function(){this.save(true);},m:function(){this.isTabIndent=!this.isTabIndent;},"1":d("formatblock","h1"),"2":d("formatblock","h2"),"3":d("formatblock","h3"),"4":d("formatblock","h4"),"\\":d("insertunorderedlist")};if(!a.isIE){f.Z=d("redo");}for(var e in f){this.addKeyHandler(e,true,false,f[e]);}},events:["onKeyPress","onKeyDown","onKeyUp"],captureEvents:[],_editorCommandsLocalized:false,_localizeEditorCommands:function(){if(c._editor._editorCommandsLocalized){this._local2NativeFormatNames=c._editor._local2NativeFormatNames;this._native2LocalFormatNames=c._editor._native2LocalFormatNames;return;}c._editor._editorCommandsLocalized=true;c._editor._local2NativeFormatNames={};c._editor._native2LocalFormatNames={};this._local2NativeFormatNames=c._editor._local2NativeFormatNames;this._native2LocalFormatNames=c._editor._native2LocalFormatNames;var d=["div","p","pre","h1","h2","h3","h4","h5","h6","ol","ul","address"];var h="",j,f=0;while((j=d[f++])){if(j.charAt(1)!=="l"){h+="<"+j+"><span>content</span></"+j+"><br/>";}else{h+="<"+j+"><li>content</li></"+j+"><br/>";}}var g={position:"absolute",top:"0px",zIndex:10,opacity:0.01};var k=a.create("div",{style:g,innerHTML:h});a.body().appendChild(k);var e=a.hitch(this,function(){var l=k.firstChild;while(l){try{c._editor.selection.selectElement(l.firstChild);var i=l.tagName.toLowerCase();this._local2NativeFormatNames[i]=document.queryCommandValue("formatblock");this._native2LocalFormatNames[this._local2NativeFormatNames[i]]=i;l=l.nextSibling.nextSibling;}catch(m){}}k.parentNode.removeChild(k);k.innerHTML="";});setTimeout(e,0);},open:function(k){if(!this.onLoadDeferred||this.onLoadDeferred.fired>=0){this.onLoadDeferred=new a.Deferred();}if(!this.isClosed){this.close();}a.publish(c._scopeName+"._editor.RichText::open",[this]);if(arguments.length==1&&k.nodeName){this.domNode=k;}var m=this.domNode;var o;if(a.isString(this.value)){o=this.value;delete this.value;m.innerHTML="";}else{if(m.nodeName&&m.nodeName.toLowerCase()=="textarea"){var l=(this.textarea=m);this.name=l.name;o=l.value;m=this.domNode=a.doc.createElement("div");m.setAttribute("widgetId",this.id);l.removeAttribute("widgetId");m.cssText=l.cssText;m.className+=" "+l.className;a.place(m,l,"before");var f=a.hitch(this,function(){a.style(l,{display:"block",position:"absolute",top:"-1000px"});if(a.isIE){var i=l.style;this.__overflow=i.overflow;i.overflow="hidden";}});if(a.isIE){setTimeout(f,10);}else{f();}if(l.form){var r=l.value;this.reset=function(){var i=this.getValue();if(i!=r){this.replaceValue(r);}};a.connect(l.form,"onsubmit",this,function(){a.attr(l,"disabled",this.disabled);l.value=this.getValue();});}}else{o=c._editor.getChildrenHtml(m);m.innerHTML="";}}var p=a.contentBox(m);this._oldHeight=p.h;this._oldWidth=p.w;this.value=o;if(m.nodeName&&m.nodeName=="LI"){m.innerHTML=" <br>";}this.header=m.ownerDocument.createElement("div");m.appendChild(this.header);this.editingArea=m.ownerDocument.createElement("div");m.appendChild(this.editingArea);this.footer=m.ownerDocument.createElement("div");m.appendChild(this.footer);if(!this.name){this.name=this.id+"_AUTOGEN";}if(this.name!==""&&(!a.config.useXDomain||a.config.allowXdRichTextSave)){var e=a.byId(c._scopeName+"._editor.RichText.value");if(e&&e.value!==""){var n=e.value.split(this._SEPARATOR),j=0,q;while((q=n[j++])){var h=q.split(this._NAME_CONTENT_SEP);if(h[0]==this.name){o=h[1];n=n.splice(j,1);e.value=n.join(this._SEPARATOR);break;}}}if(!c._editor._globalSaveHandler){c._editor._globalSaveHandler={};a.addOnUnload(function(){var s;for(s in c._editor._globalSaveHandler){var i=c._editor._globalSaveHandler[s];if(a.isFunction(i)){i();}}});}c._editor._globalSaveHandler[this.id]=a.hitch(this,"_saveContent");}this.isClosed=false;var g=(this.editorObject=this.iframe=a.doc.createElement("iframe"));g.id=this.id+"_iframe";this._iframeSrc=this._getIframeDocTxt();g.style.border="none";g.style.width="100%";if(this._layoutMode){g.style.height="100%";}else{if(a.isIE>=7){if(this.height){g.style.height=this.height;}if(this.minHeight){g.style.minHeight=this.minHeight;}}else{g.style.height=this.height?this.height:this.minHeight;}}g.frameBorder=0;g._loadFunc=a.hitch(this,function(i){this.window=i;this.document=this.window.document;if(a.isIE){this._localizeEditorCommands();}this.onLoad(o);});var t="javascript:parent."+c._scopeName+'.byId("'+this.id+'")._iframeSrc';g.setAttribute("src",t);this.editingArea.appendChild(g);if(a.isSafari<=4){var d=g.getAttribute("src");if(!d||d.indexOf("javascript")==-1){setTimeout(function(){g.setAttribute("src",t);},0);}}if(m.nodeName=="LI"){m.lastChild.style.marginTop="-1.2em";}a.addClass(this.domNode,this.baseClass);},_local2NativeFormatNames:{},_native2LocalFormatNames:{},_getIframeDocTxt:function(){var k=a.getComputedStyle(this.domNode);var g="";var j=true;if(a.isIE||a.isWebKit||(!this.height&&!a.isMoz)){g="<div id='dijitEditorBody'></div>";j=false;}else{if(a.isMoz){this._cursorToStart=true;g="&nbsp;";}}var e=[k.fontWeight,k.fontSize,k.fontFamily].join(" ");var h=k.lineHeight;if(h.indexOf("px")>=0){h=parseFloat(h)/parseFloat(k.fontSize);}else{if(h.indexOf("em")>=0){h=parseFloat(h);}else{h="normal";}}var i="";var d=this;this.style.replace(/(^|;)\s*(line-|font-?)[^;]+/ig,function(l){l=l.replace(/^;/ig,"")+";";var n=l.split(":")[0];if(n){n=a.trim(n);n=n.toLowerCase();var m;var o="";for(m=0;m<n.length;m++){var p=n.charAt(m);switch(p){case"-":m++;p=n.charAt(m).toUpperCase();default:o+=p;}}a.style(d.domNode,o,"");}i+=l+";";});var f=a.query('label[for="'+this.id+'"]');return[this.isLeftToRight()?"<html>\n<head>\n":"<html dir='rtl'>\n<head>\n",(a.isMoz&&f.length?"<title>"+f[0].innerHTML+"</title>\n":""),"<meta http-equiv='Content-Type' content='text/html'>\n","<style>\n","\tbody,html {\n","\t\tbackground:transparent;\n","\t\tpadding: 1px 0 0 0;\n","\t\tmargin: -1px 0 0 0;\n",((a.isWebKit)?"\t\twidth: 100%;\n":""),((a.isWebKit)?"\t\theight: 100%;\n":""),"\t}\n","\tbody{\n","\t\ttop:0px;\n","\t\tleft:0px;\n","\t\tright:0px;\n","\t\tfont:",e,";\n",((this.height||a.isOpera)?"":"\t\tposition: fixed;\n"),"\t\tmin-height:",this.minHeight,";\n","\t\tline-height:",h,";\n","\t}\n","\tp{ margin: 1em 0; }\n",(!j&&!this.height?"\tbody,html {overflow-y: hidden;}\n":""),"\t#dijitEditorBody{overflow-x: auto; overflow-y:"+(this.height?"auto;":"hidden;")+" outline: 0px;}\n","\tli > ul:-moz-first-node, li > ol:-moz-first-node{ padding-top: 1.2em; }\n",(!a.isIE?"\tli{ min-height:1.2em; }\n":""),"</style>\n",this._applyEditingAreaStyleSheets(),"\n","</head>\n<body ",(j?"id='dijitEditorBody' ":""),"onload='frameElement._loadFunc(window,document)' style='"+i+"'>",g,"</body>\n</html>"].join("");},_applyEditingAreaStyleSheets:function(){var g=[];if(this.styleSheets){g=this.styleSheets.split(";");this.styleSheets="";}g=g.concat(this.editingAreaStyleSheets);this.editingAreaStyleSheets=[];var h="",f=0,e;while((e=g[f++])){var d=(new a._Url(a.global.location,e)).toString();this.editingAreaStyleSheets.push(d);h+='<link rel="stylesheet" type="text/css" href="'+d+'"/>';}return h;},addStyleSheet:function(e){var d=e.toString();if(d.charAt(0)=="."||(d.charAt(0)!="/"&&!e.host)){d=(new a._Url(a.global.location,d)).toString();}if(a.indexOf(this.editingAreaStyleSheets,d)>-1){return;}this.editingAreaStyleSheets.push(d);this.onLoadDeferred.addCallback(a.hitch(this,function(){if(this.document.createStyleSheet){this.document.createStyleSheet(d);}else{var g=this.document.getElementsByTagName("head")[0];var f=this.document.createElement("link");f.rel="stylesheet";f.type="text/css";f.href=d;g.appendChild(f);}}));},removeStyleSheet:function(f){var e=f.toString();if(e.charAt(0)=="."||(e.charAt(0)!="/"&&!f.host)){e=(new a._Url(a.global.location,e)).toString();}var d=a.indexOf(this.editingAreaStyleSheets,e);if(d==-1){return;}delete this.editingAreaStyleSheets[d];a.withGlobal(this.window,"query",a,['link:[href="'+e+'"]']).orphan();},disabled:false,_mozSettingProps:{styleWithCSS:false},_setDisabledAttr:function(d){d=!!d;this._set("disabled",d);if(!this.isLoaded){return;}if(a.isIE||a.isWebKit||a.isOpera){var h=a.isIE&&(this.isLoaded||!this.focusOnLoad);if(h){this.editNode.unselectable="on";}this.editNode.contentEditable=!d;if(h){var k=this;setTimeout(function(){k.editNode.unselectable="off";},0);}}else{try{this.document.designMode=(d?"off":"on");}catch(g){return;}if(!d&&this._mozSettingProps){var i=this._mozSettingProps;for(var j in i){if(i.hasOwnProperty(j)){try{this.document.execCommand(j,false,i[j]);}catch(f){}}}}}this._disabledOK=true;},onLoad:function(g){if(!this.window.__registeredWindow){this.window.__registeredWindow=true;this._iframeRegHandle=c.registerIframe(this.iframe);}if(!a.isIE&&!a.isWebKit&&(this.height||a.isMoz)){this.editNode=this.document.body;}else{this.editNode=this.document.body.firstChild;var j=this;if(a.isIE){this.tabStop=a.create("div",{tabIndex:-1},this.editingArea);this.iframe.onfocus=function(){j.editNode.setActive();};}}this.focusNode=this.editNode;var f=this.events.concat(this.captureEvents);var d=this.iframe?this.document:this.editNode;a.forEach(f,function(e){this.connect(d,e.toLowerCase(),e);},this);this.connect(d,"onmouseup","onClick");if(a.isIE){this.connect(this.document,"onmousedown","_onIEMouseDown");this.editNode.style.zoom=1;}else{this.connect(this.document,"onmousedown",function(){delete this._cursorToStart;});}if(a.isWebKit){this._webkitListener=this.connect(this.document,"onmouseup","onDisplayChanged");this.connect(this.document,"onmousedown",function(l){var k=l.target;if(k&&(k===this.document.body||k===this.document)){setTimeout(a.hitch(this,"placeCursorAtEnd"),0);}});}if(a.isIE){try{this.document.execCommand("RespectVisibilityInDesign",true,null);}catch(i){}}this.isLoaded=true;this.set("disabled",this.disabled);var h=a.hitch(this,function(){this.setValue(g);if(this.onLoadDeferred){this.onLoadDeferred.callback(true);}this.onDisplayChanged();if(this.focusOnLoad){a.addOnLoad(a.hitch(this,function(){setTimeout(a.hitch(this,"focus"),this.updateInterval);}));}this.value=this.getValue(true);});if(this.setValueDeferred){this.setValueDeferred.addCallback(h);}else{h();}},onKeyDown:function(d){if(d.keyCode===a.keys.TAB&&this.isTabIndent){a.stopEvent(d);if(this.queryCommandEnabled((d.shiftKey?"outdent":"indent"))){this.execCommand((d.shiftKey?"outdent":"indent"));}}if(a.isIE){if(d.keyCode==a.keys.TAB&&!this.isTabIndent){if(d.shiftKey&&!d.ctrlKey&&!d.altKey){this.iframe.focus();}else{if(!d.shiftKey&&!d.ctrlKey&&!d.altKey){this.tabStop.focus();}}}else{if(d.keyCode===a.keys.BACKSPACE&&this.document.selection.type==="Control"){a.stopEvent(d);this.execCommand("delete");}else{if((65<=d.keyCode&&d.keyCode<=90)||(d.keyCode>=37&&d.keyCode<=40)){d.charCode=d.keyCode;this.onKeyPress(d);}}}}return true;},onKeyUp:function(d){return;},setDisabled:function(d){a.deprecated("dijit.Editor::setDisabled is deprecated",'use dijit.Editor::attr("disabled",boolean) instead',2);this.set("disabled",d);},_setValueAttr:function(d){this.setValue(d);},_setDisableSpellCheckAttr:function(d){if(this.document){a.attr(this.document.body,"spellcheck",!d);}else{this.onLoadDeferred.addCallback(a.hitch(this,function(){a.attr(this.document.body,"spellcheck",!d);}));}this._set("disableSpellCheck",d);},onKeyPress:function(g){var h=(g.keyChar&&g.keyChar.toLowerCase())||g.keyCode,d=this._keyHandlers[h],f=arguments;if(d&&!g.altKey){a.some(d,function(e){if(!(e.shift^g.shiftKey)&&!(e.ctrl^(g.ctrlKey||g.metaKey))){if(!e.handler.apply(this,f)){g.preventDefault();}return true;}},this);}if(!this._onKeyHitch){this._onKeyHitch=a.hitch(this,"onKeyPressed");}setTimeout(this._onKeyHitch,1);return true;},addKeyHandler:function(e,g,d,f){if(!a.isArray(this._keyHandlers[e])){this._keyHandlers[e]=[];}this._keyHandlers[e].push({shift:d||false,ctrl:g||false,handler:f});},onKeyPressed:function(){this.onDisplayChanged();},onClick:function(d){this.onDisplayChanged(d);},_onIEMouseDown:function(d){if(!this._focused&&!this.disabled){this.focus();}},_onBlur:function(f){this.inherited(arguments);var d=this.getValue(true);if(d!=this.value){this.onChange(d);}this._set("value",d);},_onFocus:function(d){if(!this.disabled){if(!this._disabledOK){this.set("disabled",false);}this.inherited(arguments);}},blur:function(){if(!a.isIE&&this.window.document.documentElement&&this.window.document.documentElement.focus){this.window.document.documentElement.focus();}else{if(a.doc.body.focus){a.doc.body.focus();}}},focus:function(){if(!this.isLoaded){this.focusOnLoad=true;return;}if(this._cursorToStart){delete this._cursorToStart;if(this.editNode.childNodes){this.placeCursorAtStart();return;}}if(!a.isIE){c.focus(this.iframe);}else{if(this.editNode&&this.editNode.focus){this.iframe.fireEvent("onfocus",document.createEventObject());}}},updateInterval:200,_updateTimer:null,onDisplayChanged:function(d){if(this._updateTimer){clearTimeout(this._updateTimer);}if(!this._updateHandler){this._updateHandler=a.hitch(this,"onNormalizedDisplayChanged");}this._updateTimer=setTimeout(this._updateHandler,this.updateInterval);},onNormalizedDisplayChanged:function(){delete this._updateTimer;},onChange:function(d){},_normalizeCommand:function(e,d){var f=e.toLowerCase();if(f=="formatblock"){if(a.isSafari&&d===undefined){f="heading";}}else{if(f=="hilitecolor"&&!a.isMoz){f="backcolor";}}return f;},_qcaCache:{},queryCommandAvailable:function(e){var d=this._qcaCache[e];if(d!==undefined){return d;}return(this._qcaCache[e]=this._queryCommandAvailable(e));},_queryCommandAvailable:function(i){var h=1;var g=1<<1;var e=1<<2;var d=1<<3;function j(k){return{ie:Boolean(k&h),mozilla:Boolean(k&g),webkit:Boolean(k&e),opera:Boolean(k&d)};}var f=null;switch(i.toLowerCase()){case"bold":case"italic":case"underline":case"subscript":case"superscript":case"fontname":case"fontsize":case"forecolor":case"hilitecolor":case"justifycenter":case"justifyfull":case"justifyleft":case"justifyright":case"delete":case"selectall":case"toggledir":f=j(g|h|e|d);break;case"createlink":case"unlink":case"removeformat":case"inserthorizontalrule":case"insertimage":case"insertorderedlist":case"insertunorderedlist":case"indent":case"outdent":case"formatblock":case"inserthtml":case"undo":case"redo":case"strikethrough":case"tabindent":f=j(g|h|d|e);break;case"blockdirltr":case"blockdirrtl":case"dirltr":case"dirrtl":case"inlinedirltr":case"inlinedirrtl":f=j(h);break;case"cut":case"copy":case"paste":f=j(h|g|e);break;case"inserttable":f=j(g|h);break;case"insertcell":case"insertcol":case"insertrow":case"deletecells":case"deletecols":case"deleterows":case"mergecells":case"splitcell":f=j(h|g);break;default:return false;}return(a.isIE&&f.ie)||(a.isMoz&&f.mozilla)||(a.isWebKit&&f.webkit)||(a.isOpera&&f.opera);},execCommand:function(g,f){var d;this.focus();g=this._normalizeCommand(g,f);if(f!==undefined){if(g=="heading"){throw new Error("unimplemented");}else{if((g=="formatblock")&&a.isIE){f="<"+f+">";}}}var e="_"+g+"Impl";if(this[e]){d=this[e](f);}else{f=arguments.length>1?f:null;if(f||g!="createlink"){d=this.document.execCommand(g,false,f);}}this.onDisplayChanged();return d;},queryCommandEnabled:function(h){if(this.disabled||!this._disabledOK){return false;}h=this._normalizeCommand(h);if(a.isMoz||a.isWebKit){if(h=="unlink"){return this._sCall("hasAncestorElement",["a"]);}else{if(h=="inserttable"){return true;}}}if(a.isWebKit){if(h=="cut"||h=="copy"){var f=this.window.getSelection();if(f){f=f.toString();}return !!f;}else{if(h=="paste"){return true;}}}var d=a.isIE?this.document.selection.createRange():this.document;try{return d.queryCommandEnabled(h);}catch(g){return false;}},queryCommandState:function(f){if(this.disabled||!this._disabledOK){return false;}f=this._normalizeCommand(f);try{return this.document.queryCommandState(f);}catch(d){return false;}},queryCommandValue:function(h){if(this.disabled||!this._disabledOK){return false;}var f;h=this._normalizeCommand(h);if(a.isIE&&h=="formatblock"){f=this._native2LocalFormatNames[this.document.queryCommandValue(h)];}else{if(a.isMoz&&h==="hilitecolor"){var d;try{d=this.document.queryCommandValue("styleWithCSS");}catch(g){d=false;}this.document.execCommand("styleWithCSS",false,true);f=this.document.queryCommandValue(h);this.document.execCommand("styleWithCSS",false,d);}else{f=this.document.queryCommandValue(h);}}return f;},_sCall:function(e,d){return a.withGlobal(this.window,e,c._editor.selection,d);},placeCursorAtStart:function(){this.focus();var d=false;if(a.isMoz){var f=this.editNode.firstChild;while(f){if(f.nodeType==3){if(f.nodeValue.replace(/^\s+|\s+$/g,"").length>0){d=true;this._sCall("selectElement",[f]);break;}}else{if(f.nodeType==1){d=true;var e=f.tagName?f.tagName.toLowerCase():"";if(/br|input|img|base|meta|area|basefont|hr|link/.test(e)){this._sCall("selectElement",[f]);}else{this._sCall("selectElementChildren",[f]);}break;}}f=f.nextSibling;}}else{d=true;this._sCall("selectElementChildren",[this.editNode]);}if(d){this._sCall("collapse",[true]);}},placeCursorAtEnd:function(){this.focus();var d=false;if(a.isMoz){var e=this.editNode.lastChild;while(e){if(e.nodeType==3){if(e.nodeValue.replace(/^\s+|\s+$/g,"").length>0){d=true;this._sCall("selectElement",[e]);break;}}else{if(e.nodeType==1){d=true;if(e.lastChild){this._sCall("selectElement",[e.lastChild]);}else{this._sCall("selectElement",[e]);}break;}}e=e.previousSibling;}}else{d=true;this._sCall("selectElementChildren",[this.editNode]);}if(d){this._sCall("collapse",[false]);}},getValue:function(d){if(this.textarea){if(this.isClosed||!this.isLoaded){return this.textarea.value;}}return this._postFilterContent(null,d);},_getValueAttr:function(){return this.getValue(true);},setValue:function(d){if(!this.isLoaded){this.onLoadDeferred.addCallback(a.hitch(this,function(){this.setValue(d);}));return;}this._cursorToStart=true;if(this.textarea&&(this.isClosed||!this.isLoaded)){this.textarea.value=d;}else{d=this._preFilterContent(d);var e=this.isClosed?this.domNode:this.editNode;if(d&&a.isMoz&&d.toLowerCase()=="<p></p>"){d="<p>&nbsp;</p>";}if(!d&&a.isWebKit){d="&nbsp;";}e.innerHTML=d;this._preDomFilterContent(e);}this.onDisplayChanged();this._set("value",this.getValue(true));},replaceValue:function(d){if(this.isClosed){this.setValue(d);}else{if(this.window&&this.window.getSelection&&!a.isMoz){this.setValue(d);}else{if(this.window&&this.window.getSelection){d=this._preFilterContent(d);this.execCommand("selectall");if(!d){this._cursorToStart=true;d="&nbsp;";}this.execCommand("inserthtml",d);this._preDomFilterContent(this.editNode);}else{if(this.document&&this.document.selection){this.setValue(d);}}}}this._set("value",this.getValue(true));},_preFilterContent:function(e){var d=e;a.forEach(this.contentPreFilters,function(f){if(f){d=f(d);}});return d;},_preDomFilterContent:function(d){d=d||this.editNode;a.forEach(this.contentDomPreFilters,function(e){if(e&&a.isFunction(e)){e(d);}},this);},_postFilterContent:function(f,e){var d;if(!a.isString(f)){f=f||this.editNode;if(this.contentDomPostFilters.length){if(e){f=a.clone(f);}a.forEach(this.contentDomPostFilters,function(g){f=g(f);});}d=c._editor.getChildrenHtml(f);}else{d=f;}if(!a.trim(d.replace(/^\xA0\xA0*/,"").replace(/\xA0\xA0*$/,"")).length){d="";}a.forEach(this.contentPostFilters,function(g){d=g(d);});return d;},_saveContent:function(f){var d=a.byId(c._scopeName+"._editor.RichText.value");if(d.value){d.value+=this._SEPARATOR;}d.value+=this.name+this._NAME_CONTENT_SEP+this.getValue(true);},escapeXml:function(d,e){d=d.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;");if(!e){d=d.replace(/'/gm,"&#39;");}return d;},getNodeHtml:function(d){a.deprecated("dijit.Editor::getNodeHtml is deprecated","use dijit._editor.getNodeHtml instead",2);return c._editor.getNodeHtml(d);},getNodeChildrenHtml:function(d){a.deprecated("dijit.Editor::getNodeChildrenHtml is deprecated","use dijit._editor.getChildrenHtml instead",2);return c._editor.getChildrenHtml(d);},close:function(e){if(this.isClosed){return;}if(!arguments.length){e=true;}if(e){this._set("value",this.getValue(true));}if(this.interval){clearInterval(this.interval);}if(this._webkitListener){this.disconnect(this._webkitListener);delete this._webkitListener;}if(a.isIE){this.iframe.onfocus=null;}this.iframe._loadFunc=null;if(this._iframeRegHandle){c.unregisterIframe(this._iframeRegHandle);delete this._iframeRegHandle;}if(this.textarea){var d=this.textarea.style;d.position="";d.left=d.top="";if(a.isIE){d.overflow=this.__overflow;this.__overflow=null;}this.textarea.value=this.value;a.destroy(this.domNode);this.domNode=this.textarea;}else{this.domNode.innerHTML=this.value;}delete this.iframe;a.removeClass(this.domNode,this.baseClass);this.isClosed=true;this.isLoaded=false;delete this.editNode;delete this.focusNode;if(this.window&&this.window._frameElement){this.window._frameElement=null;}this.window=null;this.document=null;this.editingArea=null;this.editorObject=null;},destroy:function(){if(!this.isClosed){this.close(false);}this.inherited(arguments);if(c._editor._globalSaveHandler){delete c._editor._globalSaveHandler[this.id];}},_removeMozBogus:function(d){return d.replace(/\stype="_moz"/gi,"").replace(/\s_moz_dirty=""/gi,"").replace(/_moz_resizing="(true|false)"/gi,"");},_removeWebkitBogus:function(d){d=d.replace(/\sclass="webkit-block-placeholder"/gi,"");d=d.replace(/\sclass="apple-style-span"/gi,"");d=d.replace(/<meta charset=\"utf-8\" \/>/gi,"");return d;},_normalizeFontStyle:function(d){return d.replace(/<(\/)?strong([ \>])/gi,"<$1b$2").replace(/<(\/)?em([ \>])/gi,"<$1i$2");},_preFixUrlAttributes:function(d){return d.replace(/(?:(<a(?=\s).*?\shref=)("|')(.*?)\2)|(?:(<a\s.*?href=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl=$2$3$5$2").replace(/(?:(<img(?=\s).*?\ssrc=)("|')(.*?)\2)|(?:(<img\s.*?src=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl=$2$3$5$2");},_inserthorizontalruleImpl:function(d){if(a.isIE){return this._inserthtmlImpl("<hr>");}return this.document.execCommand("inserthorizontalrule",false,d);},_unlinkImpl:function(e){if((this.queryCommandEnabled("unlink"))&&(a.isMoz||a.isWebKit)){var d=this._sCall("getAncestorElement",["a"]);this._sCall("selectElement",[d]);return this.document.execCommand("unlink",false,null);}return this.document.execCommand("unlink",false,e);},_hilitecolorImpl:function(e){var d;if(a.isMoz){this.document.execCommand("styleWithCSS",false,true);d=this.document.execCommand("hilitecolor",false,e);this.document.execCommand("styleWithCSS",false,false);}else{d=this.document.execCommand("hilitecolor",false,e);}return d;},_backcolorImpl:function(d){if(a.isIE){d=d?d:null;}return this.document.execCommand("backcolor",false,d);},_forecolorImpl:function(d){if(a.isIE){d=d?d:null;}return this.document.execCommand("forecolor",false,d);},_inserthtmlImpl:function(d){d=this._preFilterContent(d);var g=true;if(a.isIE){var f=this.document.selection.createRange();if(this.document.selection.type.toUpperCase()=="CONTROL"){var e=f.item(0);while(f.length){f.remove(f.item(0));}e.outerHTML=d;}else{f.pasteHTML(d);}f.select();}else{if(a.isMoz&&!d.length){this._sCall("remove");}else{g=this.document.execCommand("inserthtml",false,d);}}return g;},_boldImpl:function(d){if(a.isIE){this._adaptIESelection();}return this.document.execCommand("bold",false,d);},_italicImpl:function(d){if(a.isIE){this._adaptIESelection();}return this.document.execCommand("italic",false,d);},_underlineImpl:function(d){if(a.isIE){this._adaptIESelection();}return this.document.execCommand("underline",false,d);},_strikethroughImpl:function(d){if(a.isIE){this._adaptIESelection();}return this.document.execCommand("strikethrough",false,d);},getHeaderHeight:function(){return this._getNodeChildrenHeight(this.header);},getFooterHeight:function(){return this._getNodeChildrenHeight(this.footer);},_getNodeChildrenHeight:function(g){var f=0;if(g&&g.childNodes){var e;for(e=0;e<g.childNodes.length;e++){var d=a.position(g.childNodes[e]);f+=d.h;}}return f;},_isNodeEmpty:function(e,d){if(e.nodeType==1){if(e.childNodes.length>0){return this._isNodeEmpty(e.childNodes[0],d);}return true;}else{if(e.nodeType==3){return(e.nodeValue.substring(d)=="");}}return false;},_removeStartingRangeFromRange:function(f,d){if(f.nextSibling){d.setStart(f.nextSibling,0);}else{var e=f.parentNode;while(e&&e.nextSibling==null){e=e.parentNode;}if(e){d.setStart(e.nextSibling,0);}}return d;},_adaptIESelection:function(){var f=c.range.getSelection(this.window);if(f&&f.rangeCount&&!f.isCollapsed){var e=f.getRangeAt(0);var h=e.startContainer;var d=e.startOffset;while(h.nodeType==3&&d>=h.length&&h.nextSibling){d=d-h.length;h=h.nextSibling;}var g=null;while(this._isNodeEmpty(h,d)&&h!=g){g=h;e=this._removeStartingRangeFromRange(h,e);h=e.startContainer;d=0;}f.removeAllRanges();f.addRange(e);}}});return c._editor.RichText;});