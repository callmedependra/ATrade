define("dijit/form/_FormSelectWidget",["dojo","dijit","dijit/form/_FormWidget","dojo/data/util/sorter"],function(a,b){a.declare("dijit.form._FormSelectWidget",b.form._FormValueWidget,{multiple:false,options:null,store:null,query:null,queryOptions:null,onFetch:null,sortByLabel:true,loadChildrenOnOpen:false,getOptions:function(g){var f=g,e=this.options||[],c=e.length;if(f===undefined){return e;}if(a.isArray(f)){return a.map(f,"return this.getOptions(item);",this);}if(a.isObject(g)){if(!a.some(this.options,function(i,h){if(i===f||(i.value&&i.value===f.value)){f=h;return true;}return false;})){f=-1;}}if(typeof f=="string"){for(var d=0;d<c;d++){if(e[d].value===f){f=d;break;}}}if(typeof f=="number"&&f>=0&&f<c){return this.options[f];}return null;},addOption:function(c){if(!a.isArray(c)){c=[c];}a.forEach(c,function(d){if(d&&a.isObject(d)){this.options.push(d);}},this);this._loadChildren();},removeOption:function(c){if(!a.isArray(c)){c=[c];}var d=this.getOptions(c);a.forEach(d,function(e){if(e){this.options=a.filter(this.options,function(g,f){return(g.value!==e.value||g.label!==e.label);});this._removeOptionItem(e);}},this);this._loadChildren();},updateOption:function(c){if(!a.isArray(c)){c=[c];}a.forEach(c,function(e){var f=this.getOptions(e),d;if(f){for(d in e){f[d]=e[d];}}},this);this._loadChildren();},setStore:function(c,d,f){var e=this.store;f=f||{};if(e!==c){a.forEach(this._notifyConnections||[],a.disconnect);delete this._notifyConnections;if(c&&c.getFeatures()["dojo.data.api.Notification"]){this._notifyConnections=[a.connect(c,"onNew",this,"_onNewItem"),a.connect(c,"onDelete",this,"_onDeleteItem"),a.connect(c,"onSet",this,"_onSetItem")];}this._set("store",c);}this._onChangeActive=false;if(this.options&&this.options.length){this.removeOption(this.options);}if(c){this._loadingStore=true;c.fetch(a.delegate(f,{onComplete:function(g,h){if(this.sortByLabel&&!f.sort&&g.length){g.sort(a.data.util.sorter.createSortFunction([{attribute:c.getLabelAttributes(g[0])[0]}],c));}if(f.onFetch){g=f.onFetch.call(this,g,h);}a.forEach(g,function(j){this._addOptionForItem(j);},this);this._loadingStore=false;this.set("value","_pendingValue" in this?this._pendingValue:d);delete this._pendingValue;if(!this.loadChildrenOnOpen){this._loadChildren();}else{this._pseudoLoadChildren(g);}this._fetchedWith=h;this._lastValueReported=this.multiple?[]:null;this._onChangeActive=true;this.onSetStore();this._handleOnChange(this.value);},scope:this}));}else{delete this._fetchedWith;}return e;},_setValueAttr:function(f,e){if(this._loadingStore){this._pendingValue=f;return;}var d=this.getOptions()||[];if(!a.isArray(f)){f=[f];}a.forEach(f,function(j,h){if(!a.isObject(j)){j=j+"";}if(typeof j==="string"){f[h]=a.filter(d,function(i){return i.value===j;})[0]||{value:"",label:""};}},this);f=a.filter(f,function(h){return h&&h.value;});if(!this.multiple&&(!f[0]||!f[0].value)&&d.length){f[0]=d[0];}a.forEach(d,function(h){h.selected=a.some(f,function(i){return i.value===h.value;});});var g=a.map(f,function(h){return h.value;}),c=a.map(f,function(h){return h.label;});this._set("value",this.multiple?g:g[0]);this._setDisplay(this.multiple?c:c[0]);this._updateSelection();this._handleOnChange(this.value,e);},_getDisplayedValueAttr:function(){var d=this.get("value");if(!a.isArray(d)){d=[d];}var c=a.map(this.getOptions(d),function(e){if(e&&"label" in e){return e.label;}else{if(e){return e.value;}}return null;},this);return this.multiple?c:c[0];},_loadChildren:function(){if(this._loadingStore){return;}a.forEach(this._getChildren(),function(c){c.destroyRecursive();});a.forEach(this.options,this._addOptionItem,this);this._updateSelection();},_updateSelection:function(){this._set("value",this._getValueFromOpts());var c=this.value;if(!a.isArray(c)){c=[c];}if(c&&c[0]){a.forEach(this._getChildren(),function(e){var d=a.some(c,function(f){return e.option&&(f===e.option.value);});a.toggleClass(e.domNode,this.baseClass+"SelectedOption",d);b.setWaiState(e.domNode,"selected",d);},this);}},_getValueFromOpts:function(){var d=this.getOptions()||[];if(!this.multiple&&d.length){var c=a.filter(d,function(e){return e.selected;})[0];if(c&&c.value){return c.value;}else{d[0].selected=true;return d[0].value;}}else{if(this.multiple){return a.map(a.filter(d,function(e){return e.selected;}),function(e){return e.value;})||[];}}return"";},_onNewItem:function(d,c){if(!c||!c.parent){this._addOptionForItem(d);}},_onDeleteItem:function(d){var c=this.store;this.removeOption(c.getIdentity(d));},_onSetItem:function(c){this.updateOption(this._getOptionObjForItem(c));},_getOptionObjForItem:function(e){var c=this.store,d=c.getLabel(e),f=(d?c.getIdentity(e):null);return{value:f,label:d,item:e};},_addOptionForItem:function(d){var c=this.store;if(!c.isItemLoaded(d)){c.loadItem({item:d,onComplete:function(f){this._addOptionForItem(d);},scope:this});return;}var e=this._getOptionObjForItem(d);this.addOption(e);},constructor:function(c){this._oValue=(c||{}).value||null;},buildRendering:function(){this.inherited(arguments);a.setSelectable(this.focusNode,false);},_fillContent:function(){var c=this.options;if(!c){c=this.options=this.srcNodeRef?a.query(">",this.srcNodeRef).map(function(d){if(d.getAttribute("type")==="separator"){return{value:"",label:"",selected:false,disabled:false};}return{value:(d.getAttribute("data-"+a._scopeName+"-value")||d.getAttribute("value")),label:String(d.innerHTML),selected:d.getAttribute("selected")||false,disabled:d.getAttribute("disabled")||false};},this):[];}if(!this.value){this._set("value",this._getValueFromOpts());}else{if(this.multiple&&typeof this.value=="string"){this_set("value",this.value.split(","));}}},postCreate:function(){this.inherited(arguments);this.connect(this,"onChange","_updateSelection");this.connect(this,"startup","_loadChildren");this._setValueAttr(this.value,null);},startup:function(){this.inherited(arguments);var c=this.store,d={};a.forEach(["query","queryOptions","onFetch"],function(e){if(this[e]){d[e]=this[e];}delete this[e];},this);if(c&&c.getFeatures()["dojo.data.api.Identity"]){this.store=null;this.setStore(c,this._oValue,d);}},destroy:function(){a.forEach(this._notifyConnections||[],a.disconnect);this.inherited(arguments);},_addOptionItem:function(c){},_removeOptionItem:function(c){},_setDisplay:function(c){},_getChildren:function(){return[];},_getSelectedOptionsAttr:function(){return this.getOptions(this.get("value"));},_pseudoLoadChildren:function(c){},onSetStore:function(){}});return b.form._FormSelectWidget;});