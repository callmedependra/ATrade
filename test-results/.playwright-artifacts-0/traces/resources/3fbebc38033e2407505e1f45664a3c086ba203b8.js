define("dojo/dnd/Selector",["dojo","dojo/dnd/common","dojo/dnd/Container"],function(a){a.declare("dojo.dnd.Selector",a.dnd.Container,{constructor:function(b,c){if(!c){c={};}this.singular=c.singular;this.autoSync=c.autoSync;this.selection={};this.anchor=null;this.simpleSelection=false;this.events.push(a.connect(this.node,"onmousedown",this,"onMouseDown"),a.connect(this.node,"onmouseup",this,"onMouseUp"));},singular:false,getSelectedNodes:function(){var c=new a.NodeList();var d=a.dnd._empty;for(var b in this.selection){if(b in d){continue;}c.push(a.byId(b));}return c;},selectNone:function(){return this._removeSelection()._removeAnchor();},selectAll:function(){this.forInItems(function(b,c){this._addItemClass(a.byId(c),"Selected");this.selection[c]=1;},this);return this._removeAnchor();},deleteSelectedNodes:function(){var c=a.dnd._empty;for(var b in this.selection){if(b in c){continue;}var d=a.byId(b);this.delItem(b);a.destroy(d);}this.anchor=null;this.selection={};return this;},forInSelectedItems:function(d,h){h=h||a.global;var c=this.selection,g=a.dnd._empty;for(var b in c){if(b in g){continue;}d.call(h,this.getItem(b),b,this);}},sync:function(){a.dnd.Selector.superclass.sync.call(this);if(this.anchor){if(!this.getItem(this.anchor.id)){this.anchor=null;}}var c=[],d=a.dnd._empty;for(var b in this.selection){if(b in d){continue;}if(!this.getItem(b)){c.push(b);}}a.forEach(c,function(e){delete this.selection[e];},this);return this;},insertNodes:function(b,f,e,c){var d=this._normalizedCreator;this._normalizedCreator=function(h,i){var g=d.call(this,h,i);if(b){if(!this.anchor){this.anchor=g.node;this._removeItemClass(g.node,"Selected");this._addItemClass(this.anchor,"Anchor");}else{if(this.anchor!=g.node){this._removeItemClass(g.node,"Anchor");this._addItemClass(g.node,"Selected");}}this.selection[g.node.id]=1;}else{this._removeItemClass(g.node,"Selected");this._removeItemClass(g.node,"Anchor");}return g;};a.dnd.Selector.superclass.insertNodes.call(this,f,e,c);this._normalizedCreator=d;return this;},destroy:function(){a.dnd.Selector.superclass.destroy.call(this);this.selection=this.anchor=null;},markupFactory:function(c,b){c._skipStartup=true;return new a.dnd.Selector(b,c);},onMouseDown:function(f){if(this.autoSync){this.sync();}if(!this.current){return;}if(!this.singular&&!a.isCopyKey(f)&&!f.shiftKey&&(this.current.id in this.selection)){this.simpleSelection=true;if(f.button===a.mouseButtons.LEFT){a.stopEvent(f);}return;}if(!this.singular&&f.shiftKey){if(!a.isCopyKey(f)){this._removeSelection();}var g=this.getAllNodes();if(g.length){if(!this.anchor){this.anchor=g[0];this._addItemClass(this.anchor,"Anchor");}this.selection[this.anchor.id]=1;if(this.anchor!=this.current){var b=0;for(;b<g.length;++b){var d=g[b];if(d==this.anchor||d==this.current){break;}}for(++b;b<g.length;++b){var d=g[b];if(d==this.anchor||d==this.current){break;}this._addItemClass(d,"Selected");this.selection[d.id]=1;}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1;}}}else{if(this.singular){if(this.anchor==this.current){if(a.isCopyKey(f)){this.selectNone();}}else{this.selectNone();this.anchor=this.current;this._addItemClass(this.anchor,"Anchor");this.selection[this.current.id]=1;}}else{if(a.isCopyKey(f)){if(this.anchor==this.current){delete this.selection[this.anchor.id];this._removeAnchor();}else{if(this.current.id in this.selection){this._removeItemClass(this.current,"Selected");delete this.selection[this.current.id];}else{if(this.anchor){this._removeItemClass(this.anchor,"Anchor");this._addItemClass(this.anchor,"Selected");}this.anchor=this.current;this._addItemClass(this.current,"Anchor");this.selection[this.current.id]=1;}}}else{if(!(this.current.id in this.selection)){this.selectNone();this.anchor=this.current;this._addItemClass(this.current,"Anchor");this.selection[this.current.id]=1;}}}}a.stopEvent(f);},onMouseUp:function(b){if(!this.simpleSelection){return;}this.simpleSelection=false;this.selectNone();if(this.current){this.anchor=this.current;this._addItemClass(this.anchor,"Anchor");this.selection[this.current.id]=1;}},onMouseMove:function(b){this.simpleSelection=false;},onOverEvent:function(){this.onmousemoveEvent=a.connect(this.node,"onmousemove",this,"onMouseMove");},onOutEvent:function(){a.disconnect(this.onmousemoveEvent);delete this.onmousemoveEvent;},_removeSelection:function(){var d=a.dnd._empty;for(var b in this.selection){if(b in d){continue;}var c=a.byId(b);if(c){this._removeItemClass(c,"Selected");}}this.selection={};return this;},_removeAnchor:function(){if(this.anchor){this._removeItemClass(this.anchor,"Anchor");this.anchor=null;}return this;}});return a.dnd.Selector;});