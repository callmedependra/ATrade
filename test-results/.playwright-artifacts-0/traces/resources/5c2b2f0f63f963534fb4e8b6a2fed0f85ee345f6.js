define("dijit/form/FilteringSelect",["dojo","dijit","dijit/form/ComboBox"],function(a,b){a.declare("dijit.form.FilteringSelect",[b.form.MappedTextBox,b.form.ComboBoxMixin],{required:true,_lastDisplayedValue:"",_isValidSubset:function(){return this._opened;},isValid:function(){return this.item||(!this.required&&this.get("displayedValue")=="");},_refreshState:function(){if(!this.searchTimer){this.inherited(arguments);}},_callbackSetLabel:function(c,d,e){if((d&&d.query[this.searchAttr]!=this._lastQuery)||(!d&&c.length&&this.store.getIdentity(c[0])!=this._lastQuery)){return;}if(!c.length){this.valueNode.value="";b.form.TextBox.superclass._setValueAttr.call(this,"",e||(e===undefined&&!this._focused));this._set("item",null);this.validate(this._focused);}else{this.set("item",c[0],e);}},_openResultList:function(c,d){if(d.query[this.searchAttr]!=this._lastQuery){return;}b.form.ComboBoxMixin.prototype._openResultList.apply(this,arguments);if(this.item===undefined){this.validate(true);}},_getValueAttr:function(){return this.valueNode.value;},_getValueField:function(){return"value";},_setValueAttr:function(e,d){if(!this._onChangeActive){d=null;}this._lastQuery=e;if(e===null||e===""){this._setDisplayedValueAttr("",d);return;}var c=this;this.store.fetchItemByIdentity({identity:e,onItem:function(f){c._callbackSetLabel(f?[f]:[],undefined,d);}});},_setItemAttr:function(e,d,c){this.inherited(arguments);this.valueNode.value=this.value;this._lastDisplayedValue=this.textbox.value;},_getDisplayQueryString:function(c){return c.replace(/([\\\*\?])/g,"\\$1");},_setDisplayedValueAttr:function(c,e){if(c==null){c="";}if(!this._created){if(!("displayedValue" in this.params)){return;}e=false;}if(this.store){this.closeDropDown();var f=a.clone(this.query);this._lastQuery=f[this.searchAttr]=this._getDisplayQueryString(c);this.textbox.value=c;this._lastDisplayedValue=c;this._set("displayedValue",c);var g=this;var d={query:f,queryOptions:{ignoreCase:this.ignoreCase,deep:true},onComplete:function(h,i){g._fetchHandle=null;a.hitch(g,"_callbackSetLabel")(h,i,e);},onError:function(h){g._fetchHandle=null;console.error("dijit.form.FilteringSelect: "+h);a.hitch(g,"_callbackSetLabel")([],undefined,false);}};a.mixin(d,this.fetchProperties);this._fetchHandle=this.store.fetch(d);}},undo:function(){this.set("displayedValue",this._lastDisplayedValue);}});return b.form.FilteringSelect;});