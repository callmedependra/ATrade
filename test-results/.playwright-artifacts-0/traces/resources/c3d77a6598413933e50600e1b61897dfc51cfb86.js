define("dijit/_editor/range",["dojo","dijit"],function(a,b){b.range={};b.range.getIndex=function(d,l){var h=[],e=[];var k=l;var j=d;var g,c;while(d!=k){var f=0;g=d.parentNode;while((c=g.childNodes[f++])){if(c===d){--f;break;}}h.unshift(f);e.unshift(f-g.childNodes.length);d=g;}if(h.length>0&&j.nodeType==3){c=j.previousSibling;while(c&&c.nodeType==3){h[h.length-1]--;c=c.previousSibling;}c=j.nextSibling;while(c&&c.nodeType==3){e[e.length-1]++;c=c.nextSibling;}}return{o:h,r:e};};b.range.getNode=function(c,d){if(!a.isArray(c)||c.length==0){return d;}var e=d;a.every(c,function(f){if(f>=0&&f<e.childNodes.length){e=e.childNodes[f];}else{e=null;return false;}return true;});return e;};b.range.getCommonAncestor=function(k,h,l){l=l||k.ownerDocument.body;var j=function(m){var i=[];while(m){i.unshift(m);if(m!==l){m=m.parentNode;}else{break;}}return i;};var d=j(k);var g=j(h);var e=Math.min(d.length,g.length);var c=d[0];for(var f=1;f<e;f++){if(d[f]===g[f]){c=d[f];}else{break;}}return c;};b.range.getAncestor=function(f,e,c){c=c||f.ownerDocument.body;while(f&&f!==c){var d=f.nodeName.toUpperCase();if(e.test(d)){return f;}f=f.parentNode;}return null;};b.range.BlockTagNames=/^(?:P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DT|DE)$/;b.range.getBlockAncestor=function(g,f,c){c=c||g.ownerDocument.body;f=f||b.range.BlockTagNames;var h=null,e;while(g&&g!==c){var d=g.nodeName.toUpperCase();if(!h&&f.test(d)){h=g;}if(!e&&(/^(?:BODY|TD|TH|CAPTION)$/).test(d)){e=g;}g=g.parentNode;}return{blockNode:h,blockContainer:e||g.ownerDocument.body};};b.range.atBeginningOfContainer=function(c,e,h){var g=false;var f=(h==0);if(!f&&e.nodeType==3){if(/^[\s\xA0]+$/.test(e.nodeValue.substr(0,h))){f=true;}}if(f){var d=e;g=true;while(d&&d!==c){if(d.previousSibling){g=false;break;}d=d.parentNode;}}return g;};b.range.atEndOfContainer=function(e,g,h){var d=false;var c=(h==(g.length||g.childNodes.length));if(!c&&g.nodeType==3){if(/^[\s\xA0]+$/.test(g.nodeValue.substr(h))){c=true;}}if(c){var f=g;d=true;while(f&&f!==e){if(f.nextSibling){d=false;break;}f=f.parentNode;}}return d;};b.range.adjacentNoneTextNode=function(f,d){var e=f;var c=(0-f.length)||0;var g=d?"nextSibling":"previousSibling";while(e){if(e.nodeType!=3){break;}c+=e.length;e=e[g];}return[e,c];};b.range._w3c=Boolean(window.getSelection);b.range.create=function(c){if(b.range._w3c){return(c||a.global).document.createRange();}else{return new b.range.W3CRange;}};b.range.getSelection=function(e,d){if(b.range._w3c){return e.getSelection();}else{var c=new b.range.ie.selection(e);if(!d){c._getCurrentSelection();}return c;}};if(!b.range._w3c){b.range.ie={cachedSelection:{},selection:function(d){this._ranges=[];this.addRange=function(f,e){this._ranges.push(f);if(!e){f._select();}this.rangeCount=this._ranges.length;};this.removeAllRanges=function(){this._ranges=[];this.rangeCount=0;};var c=function(){var f=d.document.selection.createRange();var e=d.document.selection.type.toUpperCase();if(e=="CONTROL"){return new b.range.W3CRange(b.range.ie.decomposeControlRange(f));}else{return new b.range.W3CRange(b.range.ie.decomposeTextRange(f));}};this.getRangeAt=function(e){return this._ranges[e];};this._getCurrentSelection=function(){this.removeAllRanges();var e=c();if(e){this.addRange(e,true);}};},decomposeControlRange:function(e){var d=e.item(0),i=e.item(e.length-1);var g=d.parentNode,h=i.parentNode;var c=b.range.getIndex(d,g).o;var f=b.range.getIndex(i,h).o+1;return[g,c,h,f];},getEndPoint:function(f,d){var h=f.duplicate();h.collapse(!d);var e="EndTo"+(d?"End":"Start");var g=h.parentElement();var j,i,c;if(g.childNodes.length>0){a.every(g.childNodes,function(q,p){var m;if(q.nodeType!=3){h.moveToElementText(q);if(h.compareEndPoints(e,f)>0){if(c&&c.nodeType==3){j=c;m=true;}else{j=g;i=p;return false;}}else{if(p==g.childNodes.length-1){j=g;i=g.childNodes.length;return false;}}}else{if(p==g.childNodes.length-1){j=q;m=true;}}if(m&&j){var o=b.range.adjacentNoneTextNode(j)[0];if(o){j=o.nextSibling;}else{j=g.firstChild;}var n=b.range.adjacentNoneTextNode(j);o=n[0];var l=n[1];if(o){h.moveToElementText(o);h.collapse(false);}else{h.moveToElementText(g);}h.setEndPoint(e,f);i=h.text.length-l;return false;}c=q;return true;});}else{j=g;i=0;}if(!d&&j.nodeType==1&&i==j.childNodes.length){var k=j.nextSibling;if(k&&k.nodeType==3){j=k;i=0;}}return[j,i];},setEndPoint:function(h,c,g){var i=h.duplicate(),e,j;if(c.nodeType!=3){if(g>0){e=c.childNodes[g-1];if(e){if(e.nodeType==3){c=e;g=e.length;}else{if(e.nextSibling&&e.nextSibling.nodeType==3){c=e.nextSibling;g=0;}else{i.moveToElementText(e.nextSibling?e:c);var l=e.parentNode;var f=l.insertBefore(e.ownerDocument.createTextNode(" "),e.nextSibling);i.collapse(false);l.removeChild(f);}}}}else{i.moveToElementText(c);i.collapse(true);}}if(c.nodeType==3){var d=b.range.adjacentNoneTextNode(c);var k=d[0];j=d[1];if(k){i.moveToElementText(k);i.collapse(false);if(k.contentEditable!="inherit"){j++;}}else{i.moveToElementText(c.parentNode);i.collapse(true);}g+=j;if(g>0){if(i.move("character",g)!=g){console.error("Error when moving!");}}}return i;},decomposeTextRange:function(d){var h=b.range.ie.getEndPoint(d);var f=h[0],c=h[1];var g=h[0],e=h[1];if(d.htmlText.length){if(d.htmlText==d.text){e=c+d.text.length;}else{h=b.range.ie.getEndPoint(d,true);g=h[0],e=h[1];}}return[f,c,g,e];},setRange:function(e,g,c,h,f,i){var j=b.range.ie.setEndPoint(e,g,c);e.setEndPoint("StartToStart",j);if(!i){var d=b.range.ie.setEndPoint(e,h,f);}e.setEndPoint("EndToEnd",d||j);return e;}};a.declare("dijit.range.W3CRange",null,{constructor:function(){if(arguments.length>0){this.setStart(arguments[0][0],arguments[0][1]);this.setEnd(arguments[0][2],arguments[0][3]);}else{this.commonAncestorContainer=null;this.startContainer=null;this.startOffset=0;this.endContainer=null;this.endOffset=0;this.collapsed=true;}},_updateInternal:function(){if(this.startContainer!==this.endContainer){this.commonAncestorContainer=b.range.getCommonAncestor(this.startContainer,this.endContainer);}else{this.commonAncestorContainer=this.startContainer;}this.collapsed=(this.startContainer===this.endContainer)&&(this.startOffset==this.endOffset);},setStart:function(c,d){d=parseInt(d);if(this.startContainer===c&&this.startOffset==d){return;}delete this._cachedBookmark;this.startContainer=c;this.startOffset=d;if(!this.endContainer){this.setEnd(c,d);}else{this._updateInternal();}},setEnd:function(c,d){d=parseInt(d);if(this.endContainer===c&&this.endOffset==d){return;}delete this._cachedBookmark;this.endContainer=c;this.endOffset=d;if(!this.startContainer){this.setStart(c,d);}else{this._updateInternal();}},setStartAfter:function(c,d){this._setPoint("setStart",c,d,1);},setStartBefore:function(c,d){this._setPoint("setStart",c,d,0);},setEndAfter:function(c,d){this._setPoint("setEnd",c,d,1);},setEndBefore:function(c,d){this._setPoint("setEnd",c,d,0);},_setPoint:function(f,e,g,d){var c=b.range.getIndex(e,e.parentNode).o;this[f](e.parentNode,c.pop()+d);},_getIERange:function(){var c=(this._body||this.endContainer.ownerDocument.body).createTextRange();b.range.ie.setRange(c,this.startContainer,this.startOffset,this.endContainer,this.endOffset,this.collapsed);return c;},getBookmark:function(c){this._getIERange();return this._cachedBookmark;},_select:function(){var c=this._getIERange();c.select();},deleteContents:function(){var c=this._getIERange();c.pasteHTML("");this.endContainer=this.startContainer;this.endOffset=this.startOffset;this.collapsed=true;},cloneRange:function(){var c=new b.range.W3CRange([this.startContainer,this.startOffset,this.endContainer,this.endOffset]);c._body=this._body;return c;},detach:function(){this._body=null;this.commonAncestorContainer=null;this.startContainer=null;this.startOffset=0;this.endContainer=null;this.endOffset=0;this.collapsed=true;}});}return b.range;});