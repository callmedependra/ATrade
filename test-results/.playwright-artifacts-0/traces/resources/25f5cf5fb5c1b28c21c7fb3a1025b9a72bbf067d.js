define("dijit/layout/StackController",["dojo","dijit","dijit/_Widget","dijit/_Templated","dijit/_Container","dijit/form/ToggleButton","i18n!dijit/nls/common"],function(a,b){a.declare("dijit.layout.StackController",[b._Widget,b._Templated,b._Container],{templateString:"<span role='tablist' dojoAttachEvent='onkeypress' class='dijitStackController'></span>",containerId:"",buttonWidget:"dijit.layout._StackButton",constructor:function(){this.pane2button={};this.pane2connects={};this.pane2watches={};},buildRendering:function(){this.inherited(arguments);b.setWaiRole(this.domNode,"tablist");},postCreate:function(){this.inherited(arguments);this.subscribe(this.containerId+"-startup","onStartup");this.subscribe(this.containerId+"-addChild","onAddChild");this.subscribe(this.containerId+"-removeChild","onRemoveChild");this.subscribe(this.containerId+"-selectChild","onSelectChild");this.subscribe(this.containerId+"-containerKeyPress","onContainerKeyPress");},onStartup:function(c){a.forEach(c.children,this.onAddChild,this);if(c.selected){this.onSelectChild(c.selected);}},destroy:function(){for(var c in this.pane2button){this.onRemoveChild(b.byId(c));}this.inherited(arguments);},onAddChild:function(h,c){var e=a.getObject(this.buttonWidget);var f=new e({id:this.id+"_"+h.id,label:h.title,dir:h.dir,lang:h.lang,showLabel:h.showTitle,iconClass:h.iconClass,closeButton:h.closable,title:h.tooltip});b.setWaiState(f.focusNode,"selected","false");var g=["title","showTitle","iconClass","closable","tooltip"],d=["label","showLabel","iconClass","closeButton","title"];this.pane2watches[h.id]=a.map(g,function(j,i){return h.watch(j,function(m,k,l){f.set(d[i],l);});});this.pane2connects[h.id]=[this.connect(f,"onClick",a.hitch(this,"onButtonClick",h)),this.connect(f,"onClickCloseButton",a.hitch(this,"onCloseButtonClick",h))];this.addChild(f,c);this.pane2button[h.id]=f;h.controlButton=f;if(!this._currentChild){f.focusNode.setAttribute("tabIndex","0");b.setWaiState(f.focusNode,"selected","true");this._currentChild=h;}if(!this.isLeftToRight()&&a.isIE&&this._rectifyRtlTabList){this._rectifyRtlTabList();}},onRemoveChild:function(d){if(this._currentChild===d){this._currentChild=null;}a.forEach(this.pane2connects[d.id],a.hitch(this,"disconnect"));delete this.pane2connects[d.id];a.forEach(this.pane2watches[d.id],function(e){e.unwatch();});delete this.pane2watches[d.id];var c=this.pane2button[d.id];if(c){this.removeChild(c);delete this.pane2button[d.id];c.destroy();}delete d.controlButton;},onSelectChild:function(f){if(!f){return;}if(this._currentChild){var d=this.pane2button[this._currentChild.id];d.set("checked",false);b.setWaiState(d.focusNode,"selected","false");d.focusNode.setAttribute("tabIndex","-1");}var e=this.pane2button[f.id];e.set("checked",true);b.setWaiState(e.focusNode,"selected","true");this._currentChild=f;e.focusNode.setAttribute("tabIndex","0");var c=b.byId(this.containerId);b.setWaiState(c.containerNode,"labelledby",e.id);},onButtonClick:function(d){var c=b.byId(this.containerId);c.selectChild(d);},onCloseButtonClick:function(e){var d=b.byId(this.containerId);d.closeChild(e);if(this._currentChild){var c=this.pane2button[this._currentChild.id];if(c){b.focus(c.focusNode||c.domNode);}}},adjacent:function(c){if(!this.isLeftToRight()&&(!this.tabPosition||/top|bottom/.test(this.tabPosition))){c=!c;}var d=this.getChildren();var e=a.indexOf(d,this.pane2button[this._currentChild.id]);var f=c?1:d.length-1;return d[(e+f)%d.length];},onkeypress:function(g){if(this.disabled||g.altKey){return;}var d=null;if(g.ctrlKey||!g._djpage){var c=a.keys;switch(g.charOrCode){case c.LEFT_ARROW:case c.UP_ARROW:if(!g._djpage){d=false;}break;case c.PAGE_UP:if(g.ctrlKey){d=false;}break;case c.RIGHT_ARROW:case c.DOWN_ARROW:if(!g._djpage){d=true;}break;case c.PAGE_DOWN:if(g.ctrlKey){d=true;}break;case c.HOME:case c.END:var f=this.getChildren();if(f&&f.length){f[g.charOrCode==c.HOME?0:f.length-1].onClick();}a.stopEvent(g);break;case c.DELETE:if(this._currentChild.closable){this.onCloseButtonClick(this._currentChild);}a.stopEvent(g);break;default:if(g.ctrlKey){if(g.charOrCode===c.TAB){this.adjacent(!g.shiftKey).onClick();a.stopEvent(g);}else{if(g.charOrCode=="w"){if(this._currentChild.closable){this.onCloseButtonClick(this._currentChild);}a.stopEvent(g);}}}}if(d!==null){this.adjacent(d).onClick();a.stopEvent(g);}}},onContainerKeyPress:function(c){c.e._djpage=c.page;this.onkeypress(c.e);}});a.declare("dijit.layout._StackButton",b.form.ToggleButton,{tabIndex:"-1",buildRendering:function(c){this.inherited(arguments);b.setWaiRole((this.focusNode||this.domNode),"tab");},onClick:function(c){b.focus(this.focusNode);},onClickCloseButton:function(c){c.stopPropagation();}});return b.layout.StackController;});