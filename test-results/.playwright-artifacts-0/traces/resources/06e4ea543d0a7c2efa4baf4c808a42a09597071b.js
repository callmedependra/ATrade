define("dijit/Menu",["dojo","dijit","text!dijit/templates/Menu.html","dojo/window","dijit/_Widget","dijit/_KeyNavContainer","dijit/_Templated","dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"],function(a,b){a.declare("dijit._MenuBase",[b._Widget,b._Templated,b._KeyNavContainer],{parentMenu:null,popupDelay:500,startup:function(){if(this._started){return;}a.forEach(this.getChildren(),function(c){c.startup();});this.startupKeyNavChildren();this.inherited(arguments);},onExecute:function(){},onCancel:function(c){},_moveToPopup:function(c){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled){this.focusedChild._onClick(c);}else{var d=this._getTopMenu();if(d&&d._isMenuBar){d.focusNext();}}},_onPopupHover:function(c){if(this.currentPopup&&this.currentPopup._pendingClose_timer){var d=this.currentPopup.parentMenu;if(d.focusedChild){d.focusedChild._setSelected(false);}d.focusedChild=this.currentPopup.from_item;d.focusedChild._setSelected(true);this._stopPendingCloseTimer(this.currentPopup);}},onItemHover:function(c){if(this.isActive){this.focusChild(c);if(this.focusedChild.popup&&!this.focusedChild.disabled&&!this.hover_timer){this.hover_timer=setTimeout(a.hitch(this,"_openPopup"),this.popupDelay);}}if(this.focusedChild){this.focusChild(c);}this._hoveredChild=c;},_onChildBlur:function(d){this._stopPopupTimer();d._setSelected(false);var c=d.popup;if(c){this._stopPendingCloseTimer(c);c._pendingClose_timer=setTimeout(function(){c._pendingClose_timer=null;if(c.parentMenu){c.parentMenu.currentPopup=null;}b.popup.close(c);},this.popupDelay);}},onItemUnhover:function(c){if(this.isActive){this._stopPopupTimer();}if(this._hoveredChild==c){this._hoveredChild=null;}},_stopPopupTimer:function(){if(this.hover_timer){clearTimeout(this.hover_timer);this.hover_timer=null;}},_stopPendingCloseTimer:function(c){if(c._pendingClose_timer){clearTimeout(c._pendingClose_timer);c._pendingClose_timer=null;}},_stopFocusTimer:function(){if(this._focus_timer){clearTimeout(this._focus_timer);this._focus_timer=null;}},_getTopMenu:function(){for(var c=this;c.parentMenu;c=c.parentMenu){}return c;},onItemClick:function(d,c){if(typeof this.isShowingNow=="undefined"){this._markActive();}this.focusChild(d);if(d.disabled){return false;}if(d.popup){this._openPopup();}else{this.onExecute();d.onClick(c);}},_openPopup:function(){this._stopPopupTimer();var c=this.focusedChild;if(!c){return;}var d=c.popup;if(d.isShowingNow){return;}if(this.currentPopup){this._stopPendingCloseTimer(this.currentPopup);b.popup.close(this.currentPopup);}d.parentMenu=this;d.from_item=c;var e=this;b.popup.open({parent:this,popup:d,around:c.domNode,orient:this._orient||(this.isLeftToRight()?{TR:"TL",TL:"TR",BR:"BL",BL:"BR"}:{TL:"TR",TR:"TL",BL:"BR",BR:"BL"}),onCancel:function(){e.focusChild(c);e._cleanUp();c._setSelected(true);e.focusedChild=c;},onExecute:a.hitch(this,"_cleanUp")});this.currentPopup=d;d.connect(d.domNode,"onmouseenter",a.hitch(e,"_onPopupHover"));if(d.focus){d._focus_timer=setTimeout(a.hitch(d,function(){this._focus_timer=null;this.focus();}),0);}},_markActive:function(){this.isActive=true;a.replaceClass(this.domNode,"dijitMenuActive","dijitMenuPassive");},onOpen:function(c){this.isShowingNow=true;this._markActive();},_markInactive:function(){this.isActive=false;a.replaceClass(this.domNode,"dijitMenuPassive","dijitMenuActive");},onClose:function(){this._stopFocusTimer();this._markInactive();this.isShowingNow=false;this.parentMenu=null;},_closeChild:function(){this._stopPopupTimer();var c=this.focusedChild&&this.focusedChild.from_item;if(this.currentPopup){if(b._curFocus&&a.isDescendant(b._curFocus,this.currentPopup.domNode)){this.focusedChild.focusNode.focus();}b.popup.close(this.currentPopup);this.currentPopup=null;}if(this.focusedChild){this.focusedChild._setSelected(false);this.focusedChild._onUnhover();this.focusedChild=null;}},_onItemFocus:function(c){if(this._hoveredChild&&this._hoveredChild!=c){this._hoveredChild._onUnhover();}},_onBlur:function(){this._cleanUp();this.inherited(arguments);},_cleanUp:function(){this._closeChild();if(typeof this.isShowingNow=="undefined"){this._markInactive();}}});a.declare("dijit.Menu",b._MenuBase,{constructor:function(){this._bindings=[];},templateString:a.cache("dijit","templates/Menu.html"),baseClass:"dijitMenu",targetNodeIds:[],contextMenuForWindow:false,leftClickToOpen:false,refocus:true,postCreate:function(){if(this.contextMenuForWindow){this.bindDomNode(a.body());}else{a.forEach(this.targetNodeIds,this.bindDomNode,this);}var d=a.keys,c=this.isLeftToRight();this._openSubMenuKey=c?d.RIGHT_ARROW:d.LEFT_ARROW;this._closeSubMenuKey=c?d.LEFT_ARROW:d.RIGHT_ARROW;this.connectKeyNavHandlers([d.UP_ARROW],[d.DOWN_ARROW]);},_onKeyPress:function(c){if(c.ctrlKey||c.altKey){return;}switch(c.charOrCode){case this._openSubMenuKey:this._moveToPopup(c);a.stopEvent(c);break;case this._closeSubMenuKey:if(this.parentMenu){if(this.parentMenu._isMenuBar){this.parentMenu.focusPrev();}else{this.onCancel(false);}}else{a.stopEvent(c);}break;}},_iframeContentWindow:function(c){var d=a.window.get(this._iframeContentDocument(c))||this._iframeContentDocument(c)["__parent__"]||(c.name&&a.doc.frames[c.name])||null;return d;},_iframeContentDocument:function(c){var d=c.contentDocument||(c.contentWindow&&c.contentWindow.document)||(c.name&&a.doc.frames[c.name]&&a.doc.frames[c.name].document)||null;return d;},bindDomNode:function(e){e=a.byId(e);var h;if(e.tagName.toLowerCase()=="iframe"){var d=e,f=this._iframeContentWindow(d);h=a.withGlobal(f,a.body);}else{h=(e==a.body()?a.doc.documentElement:e);}var g={node:e,iframe:d};a.attr(e,"_dijitMenu"+this.id,this._bindings.push(g));var c=a.hitch(this,function(i){return[a.connect(i,this.leftClickToOpen?"onclick":"oncontextmenu",this,function(j){a.stopEvent(j);this._scheduleOpen(j.target,d,{x:j.pageX,y:j.pageY});}),a.connect(i,"onkeydown",this,function(j){if(j.shiftKey&&j.keyCode==a.keys.F10){a.stopEvent(j);this._scheduleOpen(j.target,d);}})];});g.connects=h?c(h):[];if(d){g.onloadHandler=a.hitch(this,function(){var i=this._iframeContentWindow(d);h=a.withGlobal(i,a.body);g.connects=c(h);});if(d.addEventListener){d.addEventListener("load",g.onloadHandler,false);}else{d.attachEvent("onload",g.onloadHandler);}}},unBindDomNode:function(j){var h;try{h=a.byId(j);}catch(i){return;}var f="_dijitMenu"+this.id;if(h&&a.hasAttr(h,f)){var d=a.attr(h,f)-1,c=this._bindings[d];a.forEach(c.connects,a.disconnect);var g=c.iframe;if(g){if(g.removeEventListener){g.removeEventListener("load",c.onloadHandler,false);}else{g.detachEvent("onload",c.onloadHandler);}}a.removeAttr(h,f);delete this._bindings[d];}},_scheduleOpen:function(e,c,d){if(!this._openTimer){this._openTimer=setTimeout(a.hitch(this,function(){delete this._openTimer;this._openMyself({target:e,iframe:c,coords:d});}),1);}},_openMyself:function(k){var j=k.target,g=k.iframe,n=k.coords;if(n){if(g){var d=j.ownerDocument,c=a.position(g,true),i=this._iframeContentWindow(g),o=a.withGlobal(i,"_docScroll",a);var h=a.getComputedStyle(g),m=a._toPixelValue,f=(a.isIE&&a.isQuirks?0:m(g,h.paddingLeft))+(a.isIE&&a.isQuirks?m(g,h.borderLeftWidth):0),l=(a.isIE&&a.isQuirks?0:m(g,h.paddingTop))+(a.isIE&&a.isQuirks?m(g,h.borderTopWidth):0);n.x+=c.x+f-o.x;n.y+=c.y+l-o.y;}}else{n=a.position(j,true);n.x+=10;n.y+=10;}var q=this;var e=b.getFocus(this);function p(){if(q.refocus){b.focus(e);}b.popup.close(q);}b.popup.open({popup:this,x:n.x,y:n.y,onExecute:p,onCancel:p,orient:this.isLeftToRight()?"L":"R"});this.focus();this._onBlur=function(){this.inherited("_onBlur",arguments);b.popup.close(this);};},uninitialize:function(){a.forEach(this._bindings,function(c){if(c){this.unBindDomNode(c.node);}},this);this.inherited(arguments);}});return b.Menu;});