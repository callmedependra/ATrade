dojo.experimental("dojox.widget.Portlet");dojo.provide("dojox.widget.Portlet");dojo.require("dijit.TitlePane");dojo.require("dojo.fx");dojo.declare("dojox.widget.Portlet",[dijit.TitlePane,dijit._Container],{resizeChildren:true,closable:true,_parents:null,_size:null,dragRestriction:false,buildRendering:function(){this.inherited(arguments);dojo.style(this.domNode,"visibility","hidden");},postCreate:function(){this.inherited(arguments);dojo.addClass(this.domNode,"dojoxPortlet");dojo.removeClass(this.arrowNode,"dijitArrowNode");dojo.addClass(this.arrowNode,"dojoxPortletIcon dojoxArrowDown");dojo.addClass(this.titleBarNode,"dojoxPortletTitle");dojo.addClass(this.hideNode,"dojoxPortletContentOuter");dojo.addClass(this.domNode,"dojoxPortlet-"+(!this.dragRestriction?"movable":"nonmovable"));var e=this;if(this.resizeChildren){this.subscribe("/dnd/drop",function(){e._updateSize();});this.subscribe("/Portlet/sizechange",function(f){e.onSizeChange(f);});this.connect(window,"onresize",function(){e._updateSize();});var a=dojo.hitch(this,function(j,h){var g=dijit.byId(j);if(g.selectChild){var f=this.subscribe(j+"-selectChild",function(l){var k=e.domNode.parentNode;while(k){if(k==l.domNode){e.unsubscribe(f);e._updateSize();break;}k=k.parentNode;}});var i=dijit.byId(h);if(g&&i){e._parents.push({parent:g,child:i});}}});var c;this._parents=[];for(var b=this.domNode.parentNode;b!=null;b=b.parentNode){var d=b.getAttribute?b.getAttribute("widgetId"):null;if(d){a(d,c);c=d;}}}this.connect(this.titleBarNode,"onmousedown",function(f){if(dojo.hasClass(f.target,"dojoxPortletIcon")){dojo.stopEvent(f);return false;}return true;});this.connect(this._wipeOut,"onEnd",function(){e._publish();});this.connect(this._wipeIn,"onEnd",function(){e._publish();});if(this.closable){this.closeIcon=this._createIcon("dojoxCloseNode","dojoxCloseNodeHover",dojo.hitch(this,"onClose"));dojo.style(this.closeIcon,"display","");}},startup:function(){if(this._started){return;}var a=this.getChildren();this._placeSettingsWidgets();dojo.forEach(a,function(c){try{if(!c.started&&!c._started){c.startup();}}catch(b){console.log(this.id+":"+this.declaredClass,b);}});this.inherited(arguments);dojo.style(this.domNode,"visibility","visible");},_placeSettingsWidgets:function(){dojo.forEach(this.getChildren(),dojo.hitch(this,function(a){if(a.portletIconClass&&a.toggle&&!a.attr("portlet")){this._createIcon(a.portletIconClass,a.portletIconHoverClass,dojo.hitch(a,"toggle"));dojo.place(a.domNode,this.containerNode,"before");a.attr("portlet",this);this._settingsWidget=a;}}));},_createIcon:function(a,d,c){var b=dojo.create("div",{"class":"dojoxPortletIcon "+a,waiRole:"presentation"});dojo.place(b,this.arrowNode,"before");this.connect(b,"onclick",c);if(d){this.connect(b,"onmouseover",function(){dojo.addClass(b,d);});this.connect(b,"onmouseout",function(){dojo.removeClass(b,d);});}return b;},onClose:function(a){dojo.style(this.domNode,"display","none");},onSizeChange:function(a){if(a==this){return;}this._updateSize();},_updateSize:function(){if(!this.open||!this._started||!this.resizeChildren){return;}if(this._timer){clearTimeout(this._timer);}this._timer=setTimeout(dojo.hitch(this,function(){var d={w:dojo.style(this.domNode,"width"),h:dojo.style(this.domNode,"height")};for(var c=0;c<this._parents.length;c++){var f=this._parents[c];var e=f.parent.selectedChildWidget;if(e&&e!=f.child){return;}}if(this._size){if(this._size.w==d.w&&this._size.h==d.h){return;}}this._size=d;var b=["resize","layout"];this._timer=null;var a=this.getChildren();dojo.forEach(a,function(j){for(var g=0;g<b.length;g++){if(dojo.isFunction(j[b[g]])){try{j[b[g]]();}catch(h){console.log(h);}break;}}});this.onUpdateSize();}),100);},onUpdateSize:function(){},_publish:function(){dojo.publish("/Portlet/sizechange",[this]);},_onTitleClick:function(a){if(a.target==this.arrowNode){this.inherited(arguments);}},addChild:function(a){this._size=null;this.inherited(arguments);if(this._started){this._placeSettingsWidgets();this._updateSize();}if(this._started&&!a.started&&!a._started){a.startup();}},destroyDescendants:function(a){this.inherited(arguments);if(this._settingsWidget){this._settingsWidget.destroyRecursive(a);}},destroy:function(){if(this._timer){clearTimeout(this._timer);}this.inherited(arguments);},_setCss:function(){this.inherited(arguments);dojo.style(this.arrowNode,"display",this.toggleable?"":"none");}});dojo.declare("dojox.widget.PortletSettings",[dijit._Container,dijit.layout.ContentPane],{portletIconClass:"dojoxPortletSettingsIcon",portletIconHoverClass:"dojoxPortletSettingsIconHover",postCreate:function(){dojo.style(this.domNode,"display","none");dojo.addClass(this.domNode,"dojoxPortletSettingsContainer");dojo.removeClass(this.domNode,"dijitContentPane");},_setPortletAttr:function(a){this.portlet=a;},toggle:function(){var a=this.domNode;if(dojo.style(a,"display")=="none"){dojo.style(a,{display:"block",height:"1px",width:"auto"});dojo.fx.wipeIn({node:a}).play();}else{dojo.fx.wipeOut({node:a,onEnd:dojo.hitch(this,function(){dojo.style(a,{display:"none",height:"",width:""});})}).play();}}});dojo.declare("dojox.widget.PortletDialogSettings",dojox.widget.PortletSettings,{dimensions:null,constructor:function(a,b){this.dimensions=a.dimensions||[300,100];},toggle:function(){if(!this.dialog){dojo.require("dijit.Dialog");this.dialog=new dijit.Dialog({title:this.title});dojo.body().appendChild(this.dialog.domNode);this.dialog.containerNode.appendChild(this.domNode);dojo.style(this.dialog.domNode,{width:this.dimensions[0]+"px",height:this.dimensions[1]+"px"});dojo.style(this.domNode,"display","");}if(this.dialog.open){this.dialog.hide();}else{this.dialog.show(this.domNode);}}});