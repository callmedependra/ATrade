define("dijit/_editor/selection",["dojo","dijit"],function(a,b){a.getObject("_editor.selection",true,b);a.mixin(b._editor.selection,{getType:function(){if(a.isIE<9){return a.doc.selection.type.toLowerCase();}else{var d="text";var c;try{c=a.global.getSelection();}catch(f){}if(c&&c.rangeCount==1){var g=c.getRangeAt(0);if((g.startContainer==g.endContainer)&&((g.endOffset-g.startOffset)==1)&&(g.startContainer.nodeType!=3)){d="control";}}return d;}},getSelectedText:function(){if(a.isIE<9){if(b._editor.selection.getType()=="control"){return null;}return a.doc.selection.createRange().text;}else{var c=a.global.getSelection();if(c){return c.toString();}}return"";},getSelectedHtml:function(){if(a.isIE<9){if(b._editor.selection.getType()=="control"){return null;}return a.doc.selection.createRange().htmlText;}else{var e=a.global.getSelection();if(e&&e.rangeCount){var d;var c="";for(d=0;d<e.rangeCount;d++){var g=e.getRangeAt(d).cloneContents();var f=a.doc.createElement("div");f.appendChild(g);c+=f.innerHTML;}return c;}return null;}},getSelectedElement:function(){if(b._editor.selection.getType()=="control"){if(a.isIE<9){var c=a.doc.selection.createRange();if(c&&c.item){return a.doc.selection.createRange().item(0);}}else{var d=a.global.getSelection();return d.anchorNode.childNodes[d.anchorOffset];}}return null;},getParentElement:function(){if(b._editor.selection.getType()=="control"){var f=this.getSelectedElement();if(f){return f.parentNode;}}else{if(a.isIE<9){var e=a.doc.selection.createRange();e.collapse(true);return e.parentElement();}else{var c=a.global.getSelection();if(c){var d=c.anchorNode;while(d&&(d.nodeType!=1)){d=d.parentNode;}return d;}}}return null;},hasAncestorElement:function(c){return this.getAncestorElement.apply(this,arguments)!=null;},getAncestorElement:function(c){var d=this.getSelectedElement()||this.getParentElement();return this.getParentOfType(d,arguments);},isTag:function(f,c){if(f&&f.tagName){var g=f.tagName.toLowerCase();for(var d=0;d<c.length;d++){var e=String(c[d]).toLowerCase();if(g==e){return e;}}}return"";},getParentOfType:function(d,c){while(d){if(this.isTag(d,c).length){return d;}d=d.parentNode;}return null;},collapse:function(e){if(window.getSelection){var d=a.global.getSelection();if(d.removeAllRanges){if(e){d.collapseToStart();}else{d.collapseToEnd();}}else{d.collapse(e);}}else{if(a.isIE){var c=a.doc.selection.createRange();c.collapse(e);c.select();}}},remove:function(){var c=a.doc.selection;if(a.isIE<9){if(c.type.toLowerCase()!="none"){c.clear();}return c;}else{c=a.global.getSelection();c.deleteFromDocument();return c;}},selectElementChildren:function(f,d){var j=a.global;var i=a.doc;var c;f=a.byId(f);if(i.selection&&a.isIE<9&&a.body().createTextRange){c=f.ownerDocument.body.createTextRange();c.moveToElementText(f);if(!d){try{c.select();}catch(h){}}}else{if(j.getSelection){var g=a.global.getSelection();if(a.isOpera){if(g.rangeCount){c=g.getRangeAt(0);}else{c=i.createRange();}c.setStart(f,0);c.setEnd(f,(f.nodeType==3)?f.length:f.childNodes.length);g.addRange(c);}else{g.selectAllChildren(f);}}}},selectElement:function(f,d){var c;var k=a.doc;var j=a.global;f=a.byId(f);if(a.isIE<9&&a.body().createTextRange){try{var h=f.tagName?f.tagName.toLowerCase():"";if(h==="img"||h==="table"){c=a.body().createControlRange();}else{c=a.body().createRange();}c.addElement(f);if(!d){c.select();}}catch(i){this.selectElementChildren(f,d);}}else{if(a.global.getSelection){var g=j.getSelection();c=k.createRange();if(g.removeAllRanges){if(a.isOpera){if(g.getRangeAt(0)){c=g.getRangeAt(0);}}c.selectNode(f);g.removeAllRanges();g.addRange(c);}}}},inSelection:function(f){if(f){var d;var j=a.doc;var c;if(a.global.getSelection){var g=a.global.getSelection();if(g&&g.rangeCount>0){c=g.getRangeAt(0);}if(c&&c.compareBoundaryPoints&&j.createRange){try{d=j.createRange();d.setStart(f,0);if(c.compareBoundaryPoints(c.START_TO_END,d)===1){return true;}}catch(i){}}}else{if(j.selection){c=j.selection.createRange();try{d=f.ownerDocument.body.createControlRange();if(d){d.addElement(f);}}catch(k){try{d=f.ownerDocument.body.createTextRange();d.moveToElementText(f);}catch(h){}}if(c&&d){if(c.compareEndPoints("EndToStart",d)===1){return true;}}}}}return false;}});return b._editor.selection;});