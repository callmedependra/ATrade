define("dijit/form/ValidationTextBox",["dojo","dijit","text!dijit/form/templates/ValidationTextBox.html","dojo/i18n","dijit/form/TextBox","dijit/Tooltip","i18n!dijit/form/nls/validate"],function(a,b){a.declare("dijit.form.ValidationTextBox",b.form.TextBox,{templateString:a.cache("dijit.form","templates/ValidationTextBox.html"),baseClass:"dijitTextBox dijitValidationTextBox",required:false,promptMessage:"",invalidMessage:"$_unset_$",missingMessage:"$_unset_$",message:"",constraints:{},regExp:".*",regExpGen:function(c){return this.regExp;},state:"",tooltipPosition:[],_setValueAttr:function(){this.inherited(arguments);this.validate(this._focused);},validator:function(c,d){return(new RegExp("^(?:"+this.regExpGen(d)+")"+(this.required?"":"?")+"$")).test(c)&&(!this.required||!this._isEmpty(c))&&(this._isEmpty(c)||this.parse(c,d)!==undefined);},_isValidSubset:function(){return this.textbox.value.search(this._partialre)==0;},isValid:function(c){return this.validator(this.textbox.value,this.constraints);},_isEmpty:function(c){return(this.trim?/^\s*$/:/^$/).test(c);},getErrorMessage:function(c){return(this.required&&this._isEmpty(this.textbox.value))?this.missingMessage:this.invalidMessage;},getPromptMessage:function(c){return this.promptMessage;},_maskValidSubsetError:true,validate:function(c){var e="";var f=this.disabled||this.isValid(c);if(f){this._maskValidSubsetError=true;}var g=this._isEmpty(this.textbox.value);var d=!f&&c&&this._isValidSubset();this._set("state",f?"":(((((!this._hasBeenBlurred||c)&&g)||d)&&this._maskValidSubsetError)?"Incomplete":"Error"));b.setWaiState(this.focusNode,"invalid",f?"false":"true");if(this.state=="Error"){this._maskValidSubsetError=c&&d;e=this.getErrorMessage(c);}else{if(this.state=="Incomplete"){e=this.getPromptMessage(c);this._maskValidSubsetError=!this._hasBeenBlurred||c;}else{if(g){e=this.getPromptMessage(c);}}}this.set("message",e);return f;},displayMessage:function(c){b.hideTooltip(this.domNode);if(c&&this._focused){b.showTooltip(c,this.domNode,this.tooltipPosition,!this.isLeftToRight());}},_refreshState:function(){this.validate(this._focused);this.inherited(arguments);},constructor:function(){this.constraints={};},_setConstraintsAttr:function(c){if(!c.locale&&this.lang){c.locale=this.lang;}this._set("constraints",c);this._computePartialRE();},_computePartialRE:function(){var f=this.regExpGen(this.constraints);this.regExp=f;var d="";if(f!=".*"){this.regExp.replace(/\\.|\[\]|\[.*?[^\\]{1}\]|\{.*?\}|\(\?[=:!]|./g,function(e){switch(e.charAt(0)){case"{":case"+":case"?":case"*":case"^":case"$":case"|":case"(":d+=e;break;case")":d+="|$)";break;default:d+="(?:"+e+"|$)";break;}});}try{"".search(d);}catch(c){d=this.regExp;console.warn("RegExp error in "+this.declaredClass+": "+this.regExp);}this._partialre="^(?:"+d+")$";},postMixInProperties:function(){this.inherited(arguments);this.messages=a.i18n.getLocalization("dijit.form","validate",this.lang);if(this.invalidMessage=="$_unset_$"){this.invalidMessage=this.messages.invalidMessage;}if(!this.invalidMessage){this.invalidMessage=this.promptMessage;}if(this.missingMessage=="$_unset_$"){this.missingMessage=this.messages.missingMessage;}if(!this.missingMessage){this.missingMessage=this.invalidMessage;}this._setConstraintsAttr(this.constraints);},_setDisabledAttr:function(c){this.inherited(arguments);this._refreshState();},_setRequiredAttr:function(c){this._set("required",c);b.setWaiState(this.focusNode,"required",c);this._refreshState();},_setMessageAttr:function(c){this._set("message",c);this.displayMessage(c);},reset:function(){this._maskValidSubsetError=true;this.inherited(arguments);},_onBlur:function(){this.displayMessage("");this.inherited(arguments);}});a.declare("dijit.form.MappedTextBox",b.form.ValidationTextBox,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting="";},serialize:function(d,c){return d.toString?d.toString():"";},toString:function(){var c=this.filter(this.get("value"));return c!=null?(typeof c=="string"?c:this.serialize(c,this.constraints)):"";},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments);},buildRendering:function(){this.inherited(arguments);this.valueNode=a.place("<input type='hidden'"+(this.name?" name='"+this.name.replace(/'/g,"&quot;")+"'":"")+"/>",this.textbox,"after");},reset:function(){this.valueNode.value="";this.inherited(arguments);}});a.declare("dijit.form.RangeBoundTextBox",b.form.MappedTextBox,{rangeMessage:"",rangeCheck:function(c,d){return("min" in d?(this.compare(c,d.min)>=0):true)&&("max" in d?(this.compare(c,d.max)<=0):true);},isInRange:function(c){return this.rangeCheck(this.get("value"),this.constraints);},_isDefinitelyOutOfRange:function(){var g=this.get("value");var f=false;var e=false;if("min" in this.constraints){var d=this.constraints.min;d=this.compare(g,((typeof d=="number")&&d>=0&&g!=0)?0:d);f=(typeof d=="number")&&d<0;}if("max" in this.constraints){var c=this.constraints.max;c=this.compare(g,((typeof c!="number")||c>0)?c:0);e=(typeof c=="number")&&c>0;}return f||e;},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange();},isValid:function(c){return this.inherited(arguments)&&((this._isEmpty(this.textbox.value)&&!this.required)||this.isInRange(c));},getErrorMessage:function(c){var d=this.get("value");if(d!==null&&d!==""&&d!==undefined&&(typeof d!="number"||!isNaN(d))&&!this.isInRange(c)){return this.rangeMessage;}return this.inherited(arguments);},postMixInProperties:function(){this.inherited(arguments);if(!this.rangeMessage){this.messages=a.i18n.getLocalization("dijit.form","validate",this.lang);this.rangeMessage=this.messages.rangeMessage;}},_setConstraintsAttr:function(c){this.inherited(arguments);if(this.focusNode){if(this.constraints.min!==undefined){b.setWaiState(this.focusNode,"valuemin",this.constraints.min);}else{b.removeWaiState(this.focusNode,"valuemin");}if(this.constraints.max!==undefined){b.setWaiState(this.focusNode,"valuemax",this.constraints.max);}else{b.removeWaiState(this.focusNode,"valuemax");}}},_setValueAttr:function(d,c){b.setWaiState(this.focusNode,"valuenow",d);this.inherited(arguments);}});return b.form.ValidationTextBox;});