dojo.provide("dojox.layout.ResizeHandle");dojo.experimental("dojox.layout.ResizeHandle");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.require("dojo.fx");dojo.require("dojo.window");dojo.declare("dojox.layout.ResizeHandle",[dijit._Widget,dijit._Templated],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:false,activeResizeClass:"dojoxResizeHandleClone",animateSizing:true,animateMethod:"chain",animateDuration:225,minHeight:100,minWidth:100,constrainMax:false,maxHeight:0,maxWidth:0,fixedAspect:false,intermediateChanges:false,startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:'<div dojoAttachPoint="resizeHandle" class="dojoxResizeHandle"><div></div></div>',postCreate:function(){this.connect(this.resizeHandle,"onmousedown","_beginSizing");if(!this.activeResize){this._resizeHelper=dijit.byId("dojoxGlobalResizeHelper");if(!this._resizeHelper){this._resizeHelper=new dojox.layout._ResizeHelper({id:"dojoxGlobalResizeHelper"}).placeAt(dojo.body());dojo.addClass(this._resizeHelper.domNode,this.activeResizeClass);}}else{this.animateSizing=false;}if(!this.minSize){this.minSize={w:this.minWidth,h:this.minHeight};}if(this.constrainMax){this.maxSize={w:this.maxWidth,h:this.maxHeight};}this._resizeX=this._resizeY=false;var a=dojo.partial(dojo.addClass,this.resizeHandle);switch(this.resizeAxis.toLowerCase()){case"xy":this._resizeX=this._resizeY=true;a("dojoxResizeNW");break;case"x":this._resizeX=true;a("dojoxResizeW");break;case"y":this._resizeY=true;a("dojoxResizeN");break;}},_beginSizing:function(b){if(this._isSizing){return false;}dojo.publish(this.startTopic,[this]);this.targetWidget=dijit.byId(this.targetId);this.targetDomNode=this.targetWidget?this.targetWidget.domNode:dojo.byId(this.targetId);if(this.targetContainer){this.targetDomNode=this.targetContainer;}if(!this.targetDomNode){return false;}if(!this.activeResize){var g=dojo.position(this.targetDomNode,true);console.log(g);console.log(dojo.window.getBox());this._resizeHelper.resize({l:g.x,t:g.y,w:g.w,h:g.h});this._resizeHelper.show();}this._isSizing=true;this.startPoint={x:b.clientX,y:b.clientY};var f=this.targetWidget?dojo.marginBox(this.targetDomNode):dojo.contentBox(this.targetDomNode);this.startSize={w:f.w,h:f.h};if(this.fixedAspect){var a,d;if(f.w>f.h){a="w";d=f.w/f.h;}else{a="h";d=f.h/f.w;}this._aspect={prop:a};this._aspect[a]=d;}this._pconnects=[];this._pconnects.push(dojo.connect(dojo.doc,"onmousemove",this,"_updateSizing"));this._pconnects.push(dojo.connect(dojo.doc,"onmouseup",this,"_endSizing"));dojo.stopEvent(b);},_updateSizing:function(b){if(this.activeResize){this._changeSizing(b);}else{var a=this._getNewCoords(b);if(a===false){return;}this._resizeHelper.resize(a);}b.preventDefault();},_getNewCoords:function(d){try{if(!d.clientX||!d.clientY){return false;}}catch(d){return false;}this._activeResizeLastEvent=d;var b=(this.isLeftToRight()?this.startPoint.x-d.clientX:d.clientX-this.startPoint.x),a=this.startPoint.y-d.clientY,f=this.startSize.w-(this._resizeX?b:0),c=this.startSize.h-(this._resizeY?a:0);return this._checkConstraints(f,c);},_checkConstraints:function(e,d){if(this.minSize){var a=this.minSize;if(e<a.w){e=a.w;}if(d<a.h){d=a.h;}}if(this.constrainMax&&this.maxSize){var c=this.maxSize;if(e>c.w){e=c.w;}if(d>c.h){d=c.h;}}if(this.fixedAspect){var b=this._aspect[this._aspect.prop];if(e<d){d=e*b;}else{if(d<e){e=d*b;}}}return{w:e,h:d};},_changeSizing:function(c){var a=this._getNewCoords(c);if(a===false){return;}if(this.targetWidget&&dojo.isFunction(this.targetWidget.resize)){this.targetWidget.resize(a);}else{if(this.animateSizing){var b=dojo.fx[this.animateMethod]([dojo.animateProperty({node:this.targetDomNode,properties:{width:{start:this.startSize.w,end:a.w}},duration:this.animateDuration}),dojo.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:a.h}},duration:this.animateDuration})]);b.play();}else{dojo.style(this.targetDomNode,{width:a.w+"px",height:a.h+"px"});}}if(this.intermediateChanges){this.onResize(c);}},_endSizing:function(b){dojo.forEach(this._pconnects,dojo.disconnect);var a=dojo.partial(dojo.publish,this.endTopic,[this]);if(!this.activeResize){this._resizeHelper.hide();this._changeSizing(b);setTimeout(a,this.animateDuration+15);}else{a();}this._isSizing=false;this.onResize(b);},onResize:function(a){}});dojo.declare("dojox.layout._ResizeHelper",dijit._Widget,{show:function(){dojo.fadeIn({node:this.domNode,duration:120,beforeBegin:function(a){dojo.style(a,"display","");}}).play();},hide:function(){dojo.fadeOut({node:this.domNode,duration:250,onEnd:function(a){dojo.style(a,"display","none");}}).play();},resize:function(a){dojo.marginBox(this.domNode,a);}});