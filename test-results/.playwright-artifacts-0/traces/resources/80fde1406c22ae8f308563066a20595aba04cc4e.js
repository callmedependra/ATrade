dojo.provide("dojox.html._base");dojo.require("dojo.html");(function(){if(dojo.isIE){var c=/(AlphaImageLoader\([^)]*?src=(['"]))(?![a-z]+:|\/)([^\r\n;}]+?)(\2[^)]*\)\s*[;}]?)/g;}var d=/(?:(?:@import\s*(['"])(?![a-z]+:|\/)([^\r\n;{]+?)\1)|url\(\s*(['"]?)(?![a-z]+:|\/)([^\r\n;]+?)\3\s*\))([a-z, \s]*[;}]?)/g;var h=dojox.html._adjustCssPaths=function(j,i){if(!i||!j){return;}if(c){i=i.replace(c,function(o,m,n,k,l){return m+(new dojo._Url(j,"./"+k).toString())+l;});}return i.replace(d,function(p,o,n,l,k,m){if(n){return'@import "'+(new dojo._Url(j,"./"+n).toString())+'"'+m;}else{return"url("+(new dojo._Url(j,"./"+k).toString())+")"+m;}});};var a=/(<[a-z][a-z0-9]*\s[^>]*)(?:(href|src)=(['"]?)([^>]*?)\3|style=(['"]?)([^>]*?)\5)([^>]*>)/gi;var e=dojox.html._adjustHtmlPaths=function(k,i){var j=k||"./";return i.replace(a,function(l,s,n,r,o,q,p,m){return s+(n?(n+"="+r+(new dojo._Url(j,o).toString())+r):("style="+q+h(j,p)+q))+m;});};var f=dojox.html._snarfStyles=function(j,i,k){k.attributes=[];return i.replace(/(?:<style([^>]*)>([\s\S]*?)<\/style>|<link\s+(?=[^>]*rel=['"]?stylesheet)([^>]*?href=(['"])([^>]*?)\4[^>\/]*)\/?>)/gi,function(t,v,n,w,m,l){var q,s=(v||w||"").replace(/^\s*([\s\S]*?)\s*$/i,"$1");if(n){q=k.push(j?h(j,n):n);}else{q=k.push('@import "'+l+'";');s=s.replace(/\s*(?:rel|href)=(['"])?[^\s]*\1\s*/gi,"");}if(s){s=s.split(/\s+/);var u={},p;for(var o=0,r=s.length;o<r;o++){p=s[o].split("=");u[p[0]]=p[1].replace(/^\s*['"]?([\s\S]*?)['"]?\s*$/,"$1");}k.attributes[q-1]=u;}return"";});};var g=dojox.html._snarfScripts=function(i,k){k.code="";i=i.replace(/<[!][-][-](.|\s)*?[-][-]>/g,function(l){return l.replace(/<(\/?)script\b/ig,"&lt;$1Script");});function j(l){if(k.downloadRemote){l=l.replace(/&([a-z0-9#]+);/g,function(n,o){switch(o){case"amp":return"&";case"gt":return">";case"lt":return"<";default:return o.charAt(0)=="#"?String.fromCharCode(o.substring(1)):"&"+o+";";}});dojo.xhrGet({url:l,sync:true,load:function(m){k.code+=m+";";},error:k.errBack});}}return i.replace(/<script\s*(?![^>]*type=['"]?(?:dojo\/|text\/html\b))(?:[^>]*?(?:src=(['"]?)([^>]*?)\1[^>]*)?)*>([\s\S]*?)<\/script>/gi,function(o,n,m,l){if(m){j(m);}else{k.code+=l;}return"";});};var b=dojox.html.evalInGlobal=function(j,i){i=i||dojo.doc.body;var k=i.ownerDocument.createElement("script");k.type="text/javascript";i.appendChild(k);k.text=j;};dojo.declare("dojox.html._ContentSetter",[dojo.html._ContentSetter],{adjustPaths:false,referencePath:".",renderStyles:false,executeScripts:false,scriptHasHooks:false,scriptHookReplacement:null,_renderStyles:function(q){this._styleNodes=[];var r,m,j,p=this.node.ownerDocument;var n=p.getElementsByTagName("head")[0];for(var k=0,l=q.length;k<l;k++){j=q[k];m=q.attributes[k];r=p.createElement("style");r.setAttribute("type","text/css");for(var o in m){r.setAttribute(o,m[o]);}this._styleNodes.push(r);n.appendChild(r);if(r.styleSheet){r.styleSheet.cssText=j;}else{r.appendChild(p.createTextNode(j));}}},empty:function(){this.inherited("empty",arguments);this._styles=[];},onBegin:function(){this.inherited("onBegin",arguments);var i=this.content,k=this.node;var j=this._styles;if(dojo.isString(i)){if(this.adjustPaths&&this.referencePath){i=e(this.referencePath,i);}if(this.renderStyles||this.cleanContent){i=f(this.referencePath,i,j);}if(this.executeScripts){var m=this;var l={downloadRemote:true,errBack:function(n){m._onError.call(m,"Exec",'Error downloading remote script in "'+m.id+'"',n);}};i=g(i,l);this._code=l.code;}}this.content=i;},onEnd:function(){var j=this._code,i=this._styles;if(this._styleNodes&&this._styleNodes.length){while(this._styleNodes.length){dojo.destroy(this._styleNodes.pop());}}if(this.renderStyles&&i&&i.length){this._renderStyles(i);}if(this.executeScripts&&j){if(this.cleanContent){j=j.replace(/(<!--|(?:\/\/)?-->|<!\[CDATA\[|\]\]>)/g,"");}if(this.scriptHasHooks){j=j.replace(/_container_(?!\s*=[^=])/g,this.scriptHookReplacement);}try{b(j,this.node);}catch(k){this._onError("Exec","Error eval script in "+this.id+", "+k.message,k);}}this.inherited("onEnd",arguments);},tearDown:function(){this.inherited(arguments);delete this._styles;if(this._styleNodes&&this._styleNodes.length){while(this._styleNodes.length){dojo.destroy(this._styleNodes.pop());}}delete this._styleNodes;dojo.mixin(this,dojo.getObject(this.declaredClass).prototype);}});dojox.html.set=function(j,i,k){if(!k){return dojo.html._setNodeContent(j,i,true);}else{var l=new dojox.html._ContentSetter(dojo.mixin(k,{content:i,node:j}));return l.set();}};})();